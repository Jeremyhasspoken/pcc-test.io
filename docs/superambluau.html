<html>
<head>
	<!-- CCU 03/2006 meta tags settings start -->
	<title>Polynesian Cultural Center</title>
	
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="referrer" content="origin">
<meta name="description" content="Buy tickets online. Polynesian Cultural Center ticket reservation system. Book your tickets instantly.">
<meta name="keywords" content="Polynesian Cultural Center, tickets,Buy Tickets, events, performances, shows, online ticketing">
<meta name="author" content="ShoWare">
<meta name="abstract" content="Buy tickets and see performance listings from Polynesian Cultural Center">
<meta name="robots" content="NOINDEX, NOFOLLOW">
<meta name="robots" content="NOSNIPPET">
<meta name="robots" content="NOARCHIVE">


<meta property="og:url"           content="https://qa-pcc.showare.net" />
<meta property="og:site_name"     content="Polynesian Cultural Center" />
<meta property="og:type"          content="website" />
<meta property="og:title"         content="Polynesian Cultural Center" />
<meta property="og:description"   content="Check This Out: Buy tickets and see performance listings from Polynesian Cultural Center" />

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.8, minimum-scale=1.0' name='viewport' />
	<meta name="google-translate-customization" content="9aaf36daf6e43103-a12f76fcd2014ac8-g804c3b886a9cdf60-11"></meta> 
    
    <link rel="stylesheet" type="text/css" href="//qa-pcc.showare.net/include/structure.css?ver=20228">
    <link rel="stylesheet" type="text/css" href="//qa-pcc.showare.net/include/style.css?ver=120228">
	<link rel="stylesheet" type="text/css" href="//qa-pcc.showare.net/include/select2.min.css">
    
		<link rel="stylesheet" type="text/css" media="only screen and (max-width: 1024px)" href="//qa-pcc.showare.net/include/mobile.css?ver=20228">
	
	<script type="text/javascript" src="//qa-pcc.showare.net/include/javascript.js?ver=20228"></script>
    <script type="text/javascript" src="//qa-pcc.showare.net/include/jq.js"></script>
	
    <script type='text/javascript' src='/include/jquery-3.4.1.min.js'></script><script type='text/javascript' src='/include/jqueryui-themes/jquery-ui.min.js'></script>
        <script async type="text/javascript" src="//qa-pcc.showare.net/include/mobile.js"></script>
    
<script type="text/javascript">
    if (!navigator.cookieEnabled) {
        alert("Your browser settings are currently configured to not allow cookies. Please enable cookies and try again.");
        window.stop();
        document.execCommand("Stop"); //works in IE, 
    }
</script>

<script type="text/javascript" src="//qa-pcc.showare.net/include/swApi.js"></script>
<script type="text/javascript">

var window = window || {};
var Showare = Showare || {};
var document = document || undefined;

Showare.Logger = {
   Settings: {
      ShouldLogInDev: true
   },
   data: null,
   env: {}
}

window.onerror = function(msg, url, lineNo, _, error) {
    var envInfo = Showare.Logger._getEnvironmentDetails();

    var message = {
        Description: msg,
        SourceFile: url,
        SourceLine: lineNo,
        Referer: envInfo.referer,
        QueryString: envInfo.querystring,
        ErrorType: Showare.Logger.Settings.ErrorType,
        Website: envInfo.website,
        ShouldLogInDev: Showare.Logger.Settings.ShouldLogInDev,
        Browser: envInfo.browser,
        IPAddress: envInfo.ipaddress
    };

    if (error != undefined) {
        message.Exception = error.stack;
    }

    if (Showare.Logger.data) {
        message.StateVariables = JSON.stringify(Showare.Logger.data);
    }

    swApi.sendRequest("POST", "/v1/errorlog/", message);
    Showare.Logger.data = null;
    return false;

    function shouldfilterError() {
        return !(
            // This error gets thrown by third party includes, to see full error, we need
            // to do https://blog.sentry.io/2016/05/17/what-is-script-error.html
            (msg.search("\s*Script error.*") == -1) &&
            // Related to iOS issue: https://github.com/getsentry/raven-js/issues/756
            (msg.search(".*evaluating 'elt.parentNode'.*") == -1))
    }
};

Showare.Logger.log = function(exception, data) {
    Showare.Logger.data = data;

    if (Object.prototype.toString.call(exception) == "[object Error]") {
        if (exception.stack) {
            var ex = exception.stack.split('\n');
            // Parse exceptions in the format of
            // ' at src (javascript.js?ver=20228:510)'
            var data = ex[1].match(/.+\((.+):(\d+):(\d+)\)/); 
            // and 
            // ' at src javascript.js?ver=20228:510'
            if (!data) {
                data = ex[1].match(/.+\s(.+):(\d+):(\d+)/);
            }
            window.onerror(ex[0], data[1], data[2], '', exception);
        } else {
            window.onerror(exception.name + ": " + exception.message, '', '');
        }
    } else {
        window.onerror(exception, '', '');
    }
};

Showare.Logger.warn = function(msg, data) {
    var logDetails = {
        environment: Showare.Logger._getEnvironmentDetails(),
        message: msg,
        data: data
    }
    
    swApi.sendRequest("POST", "/v1/errorlog/warn", logDetails);
    return;
};

Showare.Logger._getEnvironmentDetails = function() {
    Showare.Logger.Settings.ErrorType = 'Javascript';
    return  {
        browser: "Mozilla/5.0 Windows NT 10.0 Win64 x64 AppleWebKit/537.36 KHTML, like Gecko Chrome/80.0.3987.149 Safari/537.36",
        ipaddress: "98.150.205.167",
        querystring: window.location.href,
        referer: "https//qa-pcc.showare.net/",
        website: "qa-pcc.showare.net",
        basketid: "1LFQkTST0VUgMg1jk10MjM0MSyMDDIwANMyzE03MTN0OC5OTC4xEMAujA21LjT1NyQTUkhS_VlQUx_M__"
    }
}

</script><script type="text/javascript">
    //---------------------------DATEPICKER---------------------------------
    function buildDatepicker(options) {
    //Calling this function should be sufficient to create a calendar within a designated div, with and
    //EX: headerDP = buildDatepicker({"calendarID":"headerCalendar","linkedInputID":"headerCalendarInput","isModal":false,"forceDates":true, "defaultDate": "{{Output date from server Here}}"}); <~ would create a calendar object for the calendar presented at #headerCalendar, and link it to #headerCalendarInput
    //most calendar methods are specific to the document the calendar resides on, and should be handled via the onChange event for the linked input
    //Available Options:
    //  calendarID (required)       == string, ID of calendar div
    //  linkedInput (required)      == string, ID of input which will change when a date is selected
    //  isModal                     == boolean, if true, calendar will be hidden, and display when the designated input recieves focus. If false, the calendar will be present and display as an inline block at all times.
    //  forceDates                  == boolean, if true only highlighted dates will be clickable
    //  defaultDate                 == string, mm/dd/yyyy date that calendar should start on (this will only represent the month displayed at the begining)
    //  type                        == string: defaults to "performancedates", which will add all visible performances
    //  eventID                     == integer: defaults to -1 which means no event. Other values will filter by events with that ID, allowing for a search of performance dates for a specific event only
    //
    //Methods:
    //  showDlg()/hideDlg()             : shows/hides modal calendars, no valid for non-modal calendars
    //  addHighlightDay(mm/dd/yyyy)     : adds a date (presented as a mm/dd/yyyy string) to the list of highlight dates for the calendar - REQUIRES HighlightDays() function call to visually represent this change on the calendar
    //  clearHihghlightDays()           : removes all stored highlight dates
    //  highlightDays()                 : adds highlight class to stored days, visually highlighting them ont he calendar.

    var myID = options.calendarID; //required
    var myLinkedInput = options.linkedInputID; //required
    var isModal = options.isModal || false;
    var forceDates = options.forceDates || false;
    var myDefault = new Date();
    if (options.defaultDate) {
        try{
            myDefault = new Date(options.defaultDate)
        } catch (e) {
            console.log("date no valid for calendar: " + myID);
            console.log(e);
        }
    }
    var type = options.type || "performancedates";
    var eventID = options.eventID || -1;
    var bundleID = options.bundleID || -1;
    var categoryID = options.CategoryID || -1;

    return new swDatepicker(myID, myLinkedInput, isModal, forceDates, myDefault, type, eventID, bundleID, categoryID)
}
function swDatepicker(id, target, modal, force, defaultDate, type, eventID, bundleID, categoryID) {

    this.$id = $('#' + id); // element to attach widget to
    this.$monthObj = this.$id.find('.month');
    this.$prev = this.$id.find('.bn_prev');
    this.$next = this.$id.find('.bn_next');
    this.$grid = this.$id.find('.cal');
    this.$target = $('#' + target); // div or text box that will receive the selected date string and focus (if modal)
    this.bModal = modal; // true if datepicker should appear in a modal dialog box.
    this.forceDateSelection = force; //if true, will only allow users to click on highlighted dates - see addHighlightDay()
    this.active = !modal;
    this.type = type;
    this.eventID = eventID;
    this.bundleID = bundleID;
    this.categoryID = categoryID;

    this.calendarName = id;

    this.monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
    'July', 'August', 'September', 'October', 'November', 'December'];

    this.dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

    this.dateObj = new Date();

    this.curYear = this.dateObj.getFullYear();
    this.year = defaultDate.getFullYear();

    this.curMonth = this.dateObj.getMonth();
    this.month = defaultDate.getMonth();
    this.getFirstDate(defaultDate.getMonth()); //update the month to the first performance ASAP

    this.curDate = this.dateObj.getDate();
    this.date = defaultDate.getDate();
    this.currentDate = (this.month == this.curMonth && this.year == this.curYear);
    this.activeMonth = (String(this.month + 1) + "/1/" + this.year)

    this.keys = {
        tab: 9,
        enter: 13,
        esc: 27,
        space: 32,
        pageup: 33,
        pagedown: 34,
        end: 35,
        home: 36,
        left: 37,
        up: 38,
        right: 39,
        down: 40
    };

    this.highlightDates = [];

    //determine first date, if needed
    

    // display the current month
    this.$monthObj.html(this.monthNames[this.month] + ' ' + this.year);

    // populate the calendar grid
    this.popGrid();

    // update the table's activedescdendant to point to the current day
    this.$grid.attr('aria-activedescendant', this.$grid.find('.today').attr('id'));

    this.bindHandlers();

    // hide dialog if in modal mode
    if (this.bModal == true) {
        this.$id.attr('aria-hidden', 'true');
        //show/hide functionality may vary based on use, so should be handled after the datepicker is created.
        //if we're on mobile, disable keyboard for the input:
        if ($(window).width() < 1024) {
            this.$target.attr("readonly", "true");
        }
    }
}

//
// popGrid() is a member function to populate the datepicker grid with calendar days
// representing the current month
//
// @return N/A
//
swDatepicker.prototype.popGrid = function () {

    var numDays = this.calcNumDays(this.year, this.month);
    var startWeekday = this.calcStartWeekday(this.year, this.month);
    var weekday = 0;
    var curDay = 1;
    var rowCount = 1;
    var $tbody = this.$grid.find('tbody');

    var gridCells = '\t<tr id="row1">\n';

    // clear the grid
    $tbody.empty();
    $('#msg').empty();

    // Insert the leading empty cells
    for (weekday = 0; weekday < startWeekday; weekday++) {

        gridCells += '\t\t<td class="empty">&nbsp;</td>\n';
    }

    // insert the days of the month.
    for (curDay = 1; curDay <= numDays; curDay++) {

        if (curDay == this.curDate && this.currentDate == true) {

            gridCells += '\t\t<td id="' + this.calendarName + '-day' + curDay + '" class="today" headers="row' +
            rowCount + ' ' + this.dayNames[weekday] + '" role="gridcell" aria-selected="false"><span class="calendar-day notranslate">' + curDay + '</span></td>';

        }
        else {
            gridCells += '\t\t<td id="' + this.calendarName + '-day' + curDay + '" headers="row' +
            rowCount + ' ' + this.dayNames[weekday] + '" role="gridcell" aria-selected="false"><span class="calendar-day notranslate">' + curDay + '</span></td>';
        }


        if (weekday == 6 && curDay < numDays) {
            // This was the last day of the week, close it out
            // and begin a new one
            gridCells += '\t</tr>\n\t<tr id="row' + rowCount + '">\n';
            rowCount++;
            weekday = 0;
        }
        else {
            weekday++;
        }
    }

    // Insert any trailing empty cells
    for (weekday; weekday < 7; weekday++) {

        gridCells += '\t\t<td class="empty">&nbsp;</td>\n';
    }

    gridCells += '\t</tr>';

    $tbody.append(gridCells);

    this.fetchDates();
}

//
// calcNumDays() is a member function to calculate the number of days in a given month
//
// @return (integer) number of days
//
swDatepicker.prototype.calcNumDays = function (year, month) {

    return 32 - new Date(year, month, 32).getDate();
}

//
// calcstartWeekday() is a member function to calculate the day of the week the first day of a
// month lands on
//
// @return (integer) number representing the day of the week (0=Sunday....6=Saturday)
//
swDatepicker.prototype.calcStartWeekday = function (year, month) {

    return new Date(year, month, 1).getDay();

} // end calcStartWeekday()

//
// showPrevMonth() is a member function to show the previous month
//
// @param (offset int) offset may be used to specify an offset for setting
//                      focus on a day the specified number of days from
//                      the end of the month.
// @return N/A
//
swDatepicker.prototype.showPrevMonth = function (offset) {
    // show the previous month
    if (this.month < 1) {
        this.month = 11;
        this.year--;
    }
    else {
        this.month--;
    }

    if (this.month != this.curMonth || this.year != this.curYear) {
        this.currentDate = false;
    }
    else {
        this.currentDate = true;
    }

    this.activeMonth = (String(this.month + 1) + "/1/" + this.year)

    // populate the calendar grid
    this.popGrid();

    this.$monthObj.html(this.monthNames[this.month] + ' ' + this.year);

    // if offset was specified, set focus on the last day - specified offset
    if (offset != null) {
        var numDays = this.calcNumDays(this.year, this.month);
        var day = 'day' + (numDays - offset);

        this.$grid.attr('aria-activedescendant', this.calendarName + '-' + day);
        $('#' + this.calendarName + '-' + day).addClass('focus').attr('aria-selected', 'true');
    }

} // end showPrevMonth()

//
// showNextMonth() is a member function to show the next month
//
// @param (offset int) offset may be used to specify an offset for setting
//                      focus on a day the specified number of days from
//                      the beginning of the month.
// @return N/A
//
swDatepicker.prototype.showNextMonth = function (offset) {

    // show the next month
    if (this.month == 11) {
        this.month = 0;
        this.year++;
    }
    else {
        this.month++;
    }

    if (this.month != this.curMonth || this.year != this.curYear) {
        this.currentDate = false;
    }
    else {
        this.currentDate = true;
    }

    this.activeMonth = (String(this.month + 1) + "/1/" + this.year)

    // populate the calendar grid
    this.popGrid();

    this.$monthObj.html(this.monthNames[this.month] + ' ' + this.year);

    // if offset was specified, set focus on the first day + specified offset
    if (offset != null) {
        var day = 'day' + offset;

        this.$grid.attr('aria-activedescendant', this.calendarName + '-' + day);
        $('#' + this.calendarName + '-' + day).addClass('focus').attr('aria-selected', 'true');
    }

} // end showNextMonth()

//
// showPrevYear() is a member function to show the previous year
//
// @return N/A
//
swDatepicker.prototype.showPrevYear = function () {

    // decrement the year
    this.year--;

    if (this.month != this.curMonth || this.year != this.curYear) {
        this.currentDate = false;
    }
    else {
        this.currentDate = true;
    }

    // populate the calendar grid
    this.popGrid();

    this.$monthObj.html(this.monthNames[this.month] + ' ' + this.year);

} // end showPrevYear()

//
// showNextYear() is a member function to show the next year
//
// @return N/A
//
swDatepicker.prototype.showNextYear = function () {

    // increment the year
    this.year++;

    if (this.month != this.curMonth || this.year != this.curYear) {
        this.currentDate = false;
    }
    else {
        this.currentDate = true;
    }

    // populate the calendar grid
    this.popGrid();

    this.$monthObj.html(this.monthNames[this.month] + ' ' + this.year);

} // end showNextYear()

//
// bindHandlers() is a member function to bind event handlers for the widget
//
// @return N/A
//
swDatepicker.prototype.bindHandlers = function () {

    var thisObj = this;

    ////////////////////// bind button handlers //////////////////////////////////
    this.$prev.click(function (e) {
        return thisObj.handlePrevClick(e);
    });

    this.$next.click(function (e) {
        return thisObj.handleNextClick(e);
    });

    this.$prev.keydown(function (e) {
        return thisObj.handlePrevKeyDown(e);
    });

    this.$next.keydown(function (e) {
        return thisObj.handleNextKeyDown(e);
    });

    ///////////// bind grid handlers //////////////

    this.$grid.keydown(function (e) {
        return thisObj.handleGridKeyDown(e);
    });

    this.$grid.keypress(function (e) {
        return thisObj.handleGridKeyPress(e);
    });

    this.$grid.focus(function (e) {
        return thisObj.handleGridFocus(e);
    });

    this.$grid.blur(function (e) {
        return thisObj.handleGridBlur(e);
    });

    this.$grid.delegate('td', 'click', function (e) {
        return thisObj.handleGridClick(this, e);
    });

} // end bindHandlers();

//
// handlePrevClick() is a member function to process click events for the prev month button
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handlePrevClick = function (e) {

    var active = this.$grid.attr('aria-activedescendant');

    if (e.ctrlKey) {
        this.showPrevYear();
    }
    else {
        this.showPrevMonth();
    }

    if (this.currentDate == false) {
        this.$grid.attr('aria-activedescendant', this.calendarName + '-day1');
    }
    else {
        this.$grid.attr('aria-activedescendant', active);
    }

    e.stopPropagation();
    return false;

} // end handlePrevClick()

//
// handleNextClick() is a member function to process click events for the next month button
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handleNextClick = function (e) {

    var active = this.$grid.attr('aria-activedescendant');

    if (e.ctrlKey) {
        this.showNextYear();
    }
    else {
        this.showNextMonth();
    }

    if (this.currentDate == false) {
        this.$grid.attr('aria-activedescendant', this.calendarName + '-day1');
    }
    else {
        this.$grid.attr('aria-activedescendant', active);
    }

    e.stopPropagation();
    return false;

} // end handleNextClick()

//
// handlePrevKeyDown() is a member function to process keydown events for the prev month button
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handlePrevKeyDown = function (e) {

    if (e.altKey) {
        return true;
    }

    switch (e.keyCode) {
        case this.keys.tab: {
            if (this.bModal == false || !e.shiftKey || e.ctrlKey) {
                return true;
            }

            this.$grid.focus();
            e.stopPropagation();
            return false;
        }
        case this.keys.enter:
        case this.keys.space: {
            if (e.shiftKey) {
                return true;
            }

            if (e.ctrlKey) {
                this.showPrevYear();
            }
            else {
                this.showPrevMonth();
            }

            e.stopPropagation();
            return false;
        }
    }

    return true;

} // end handlePrevKeyDown()

//
// handleNextKeyDown() is a member function to process keydown events for the next month button
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handleNextKeyDown = function (e) {

    if (e.altKey) {
        return true;
    }

    switch (e.keyCode) {
        case this.keys.enter:
        case this.keys.space: {

            if (e.ctrlKey) {
                this.showNextYear();
            }
            else {
                this.showNextMonth();
            }

            e.stopPropagation();
            return false;
        }
    }

    return true;

} // end handleNextKeyDown()

//
// handleGridKeyDown() is a member function to process keydown events for the datepicker grid
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handleGridKeyDown = function (e) {

    var $rows = this.$grid.find('tbody tr');
    var $curDay = $('#' + this.$grid.attr('aria-activedescendant'));
    var $days = this.$grid.find('td').not('.empty');
    var $curRow = $curDay.parent();

    if (e.altKey) {
        return true;
    }

    switch (e.keyCode) {
        case this.keys.tab: {

            if (this.bModal == true) {
                if (e.shiftKey) {
                    this.$next.focus();
                }
                else {
                    this.$prev.focus();
                }
                e.stopPropagation()
                return false;
            }
            break;
        }
        case this.keys.enter:
        case this.keys.space: {

            if (e.ctrlKey) {
                return true;
            }

            // update the target box
            this.$target.val((this.month + 1) + '/' + $curDay.text() + '/' + this.year).change();

            // fall through
        }
        case this.keys.esc: {
            // dismiss the dialog box
            this.hideDlg();

            e.stopPropagation();
            return false;
        }
        case this.keys.left: {

            if (e.ctrlKey || e.shiftKey) {
                return true;
            }

            var dayIndex = $days.index($curDay) - 1;
            var $prevDay = null;

            if (dayIndex >= 0) {
                $prevDay = $days.eq(dayIndex);

                $curDay.removeClass('focus').attr('aria-selected', 'false');
                $prevDay.addClass('focus').attr('aria-selected', 'true');

                this.$grid.attr('aria-activedescendant', $prevDay.attr('id'));
            }
            else {
                this.showPrevMonth(0);
            }

            e.stopPropagation();
            return false;
        }
        case this.keys.right: {

            if (e.ctrlKey || e.shiftKey) {
                return true;
            }

            var dayIndex = $days.index($curDay) + 1;
            var $nextDay = null;

            if (dayIndex < $days.length) {
                $nextDay = $days.eq(dayIndex);
                $curDay.removeClass('focus').attr('aria-selected', 'false');
                $nextDay.addClass('focus').attr('aria-selected', 'true');

                this.$grid.attr('aria-activedescendant', $nextDay.attr('id'));
            }
            else {
                // move to the next month
                this.showNextMonth(1);
            }

            e.stopPropagation();
            return false;
        }
        case this.keys.up: {

            if (e.ctrlKey || e.shiftKey) {
                return true;
            }

            var dayIndex = $days.index($curDay) - 7;
            var $prevDay = null;

            if (dayIndex >= 0) {
                $prevDay = $days.eq(dayIndex);

                $curDay.removeClass('focus').attr('aria-selected', 'false');
                $prevDay.addClass('focus').attr('aria-selected', 'true');

                this.$grid.attr('aria-activedescendant', $prevDay.attr('id'));
            }
            else {
                // move to appropriate day in previous month
                dayIndex = 6 - $days.index($curDay);

                this.showPrevMonth(dayIndex);
            }

            e.stopPropagation();
            return false;
        }
        case this.keys.down: {

            if (e.ctrlKey || e.shiftKey) {
                return true;
            }

            var dayIndex = $days.index($curDay) + 7;
            var $prevDay = null;

            if (dayIndex < $days.length) {
                $prevDay = $days.eq(dayIndex);

                $curDay.removeClass('focus').attr('aria-selected', 'false');
                $prevDay.addClass('focus').attr('aria-selected', 'true');

                this.$grid.attr('aria-activedescendant', $prevDay.attr('id'));
            }
            else {
                // move to appropriate day in next month
                dayIndex = 8 - ($days.length - $days.index($curDay));

                this.showNextMonth(dayIndex);
            }

            e.stopPropagation();
            return false;
        }
        case this.keys.pageup: {
            var active = this.$grid.attr('aria-activedescendant');


            if (e.shiftKey) {
                return true;
            }


            if (e.ctrlKey) {
                this.showPrevYear();
            }
            else {
                this.showPrevMonth();
            }

            if ($('#' + active).attr('id') == undefined) {
                var lastDay = 'day' + this.calcNumDays(this.year, this.month);
                $('#' + this.calendarName + '-' + lastDay).addClass('focus').attr('aria-selected', 'true');
            }
            else {
                $('#' + this.calendarName + '-' + active).addClass('focus').attr('aria-selected', 'true');
            }

            e.stopPropagation();
            return false;
        }
        case this.keys.pagedown: {
            var active = this.$grid.attr('aria-activedescendant');


            if (e.shiftKey) {
                return true;
            }

            if (e.ctrlKey) {
                this.showNextYear();
            }
            else {
                this.showNextMonth();
            }

            if ($('#' + active).attr('id') == undefined) {
                var lastDay = 'day' + this.calcNumDays(this.year, this.month);
                $('#' + this.calendarName + '-' + lastDay).addClass('focus').attr('aria-selected', 'true');
            }
            else {
                $('#' + this.calendarName + '-' + active).addClass('focus').attr('aria-selected', 'true');
            }

            e.stopPropagation();
            return false;
        }
        case this.keys.home: {

            if (e.ctrlKey || e.shiftKey) {
                return true;
            }

            $curDay.removeClass('focus').attr('aria-selected', 'false');

            $('#' + this.calendarName + '-day1').addClass('focus').attr('aria-selected', 'true');

            this.$grid.attr('aria-activedescendant', this.calendarName + '-day1');

            e.stopPropagation();
            return false;
        }
        case this.keys.end: {

            if (e.ctrlKey || e.shiftKey) {
                return true;
            }

            var lastDay = 'day' + this.calcNumDays(this.year, this.month);

            $curDay.removeClass('focus').attr('aria-selected', 'false');

            $('#' + this.calendarName + '-' + lastDay).addClass('focus').attr('aria-selected', 'true');

            this.$grid.attr('aria-activedescendant', this.calendarName + '-' + lastDay);

            e.stopPropagation();
            return false;
        }
    }

    return true;

} // end handleGridKeyDown()

//
// handleGridKeyPress() is a member function to consume keypress events for browsers that
// use keypress to scroll the screen and manipulate tabs
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handleGridKeyPress = function (e) {

    if (e.altKey) {
        return true;
    }

    switch (e.keyCode) {
        case this.keys.tab:
        case this.keys.enter:
        case this.keys.space:
        case this.keys.esc:
        case this.keys.left:
        case this.keys.right:
        case this.keys.up:
        case this.keys.down:
        case this.keys.pageup:
        case this.keys.pagedown:
        case this.keys.home:
        case this.keys.end: {
            e.stopPropagation();
            return false;
        }
    }

    return true;

} // end handleGridKeyPress()

//
// handleGridClick() is a member function to process mouse click events for the datepicker grid
//
// @input (id obj) e is the id of the object triggering the event
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handleGridClick = function (id, e) {
    var $cell = $(id);

    if ($cell.is('.empty')) {
        return true;
    }

    this.$grid.find('.focus').removeClass('focus').attr('aria-selected', 'false');
    $cell.addClass('focus').attr('aria-selected', 'true');
    this.$grid.attr('aria-activedescendant', $cell.attr('id'));

    var $curDay = $('#' + this.$grid.attr('aria-activedescendant'));

    // update the target box
    if (!this.forceDateSelection || $cell.hasClass("highlight-day")) {
        this.$target.val((this.month + 1) + '/' + $curDay.text() + '/' + this.year).change();

        // dismiss the dialog box
        this.hideDlg();
    }
    e.stopPropagation();
    return false;

} // end handleGridClick()

//
// handleGridFocus() is a member function to process focus events for the datepicker grid
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) true
//
swDatepicker.prototype.handleGridFocus = function (e) {
    var active = this.$grid.attr('aria-activedescendant');

    if ($('#' + active).attr('id') == undefined) {
        var lastDay = 'day' + this.calcNumDays(this.year, this.month);
        $('#' + lastDay).addClass('focus').attr('aria-selected', 'true');
    }
    else {
        $('#' + active).addClass('focus').attr('aria-selected', 'true');
    }

    return true;

} // end handleGridFocus()

//
// handleGridBlur() is a member function to process blur events for the datepicker grid
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) true
//
swDatepicker.prototype.handleGridBlur = function (e) {
    $('#' + this.$grid.attr('aria-activedescendant')).removeClass('focus').attr('aria-selected', 'false');

    return true;

} // end handleGridBlur()

//
// showDlg() is a member function to show the datepicker and give it focus. This function is only called if
// the datepicker is used in modal dialog mode.
//
// @return N/A
//
swDatepicker.prototype.showDlg = function () {
    if (!this.bModal)
        return;

    var thisObj = this;
    var thisNode = this.$id;

    this.highlightDays();

    this.active = true;

    //prevent calendar from pushing out of the right side of the window
    if (thisNode.parent()[0].getBoundingClientRect().left > (window.innerWidth / 2))
        thisNode.addClass("right-side");

    $(".content-wrap").bind('click', function (e) {
        if (!thisNode[0].contains(e.target) && e.target != thisObj.$target[0]) {
            thisObj.hideDlg();
        }
    });

    // show the dialog
    this.$id.attr('aria-hidden', 'false');

    this.$grid.focus();

} // end showDlg()

//
// hideDlg() is a member function to hide the datepicker and remove focus. This function is only called if
// the datepicker is used in modal dialog mode.
//
// @return N/A
//
swDatepicker.prototype.hideDlg = function () {
    if (!this.bModal)
        return;
    
    this.active = false;
    var thisNode = this.$id;

    // unbind the modal event sinks
    $(document).unbind('click');

    // hide the dialog
    this.$id.attr('aria-hidden', 'true');

    // set focus on the focus target
    //this.$target.focus();

} // end showDlg()

//function to highlight days with performances or valid information
//to prevent rewriting the calendar each time a date is added, popGrid() should be called after all dates have been added
swDatepicker.prototype.addHighlightDay = function (date) {
    var datesplit = String(date).split("/");
    if (datesplit.length != 3) {
        //date didn't come in in m/d/yyyy format, kick it back in the console
        console.log("invalid date sent, datepicker accepts m/d/yyyy only - " + date);
        console.log(date);
        return;

    }
    this.highlightDates.push(date);

    if (parseInt(datesplit[0]) - 1 == this.month && parseInt(datesplit[2]) == this.year) {
        $("#" + this.calendarName + "-day" + datesplit[1]).addClass("highlight-day");
    }
}
swDatepicker.prototype.clearHighlightDays = function () {
    this.highlightDates = [];
    this.highlightDays();
}
//highlights all days in the highlightDates array
swDatepicker.prototype.highlightDays = function () {
    $("#" + this.calendarName + " .highlight-day").removeClass("highlight-day");
    var curYear = this.year;
    var curMonth = this.month;
    var calName = this.calendarName;
    var IEFix = new RegExp(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g);

    this.highlightDates.forEach(function (o, i, a) {

        var datesplit = o.split("/");
        if (parseInt(datesplit[0].replace(IEFix, '')) - 1 == parseInt(curMonth) && parseInt(datesplit[2].replace(IEFix, '')) == parseInt(curYear)) {
            $("#" + calName + "-day" + datesplit[1].replace(IEFix, '')).addClass("highlight-day");
        }
    });
}
swDatepicker.prototype.fetchDates = function(){
    var thisCalendar = this;
    var haveDates = thisCalendar.fetchLocalDates();
    if (thisCalendar.categoryID >= 0)
        haveDates = false;
    this.clearHighlightDays();
    if(haveDates){
        //valid local dates stored
        try{
            haveDates = JSON.parse(haveDates);
            if (haveDates.length > 0) {
                haveDates.forEach(function(o){
                    thisCalendar.addHighlightDay(o);
                })
                thisCalendar.highlightDays();
            }
        } catch (e) {
            console.log("Failed to grab dates. Date object not valid: " + haveDates);
            console.log(e);
        }
    } else {
        $.getJSON("/include/widgets/calendar/calendarRequests.asp",
            {
                action: thisCalendar.type,
                calMonth: thisCalendar.activeMonth,
                iEvent: thisCalendar.eventID,
                iBundle: thisCalendar.bundleID,
                iCategory : thisCalendar.categoryID
            })
            .done(function (data) {
                thisCalendar.storeDates(data.performancedates);
                try {
                    if (data.performancedates.length > 0) {
                        data.performancedates.forEach(function (o) {
                            thisCalendar.addHighlightDay(o);
                        })
                        thisCalendar.highlightDays();
                    }
                } catch (e) {
                    console.log("Failed to grab dates. Date object not valid: " + haveDates);
                    console.log(e);
                }
            })
            .fail(function (jqxhr, textStatus, error) {
                var err = textStatus + ", " + error;
                console.log("Request Failed: " + err);
            });
    }
}
swDatepicker.prototype.getFirstDate = function(defaultMonth){
    var thisCalendar = this;
    //this should only happen once on calendar load - currently only enabled for bundles
    if(thisCalendar.bundleID == 0 || thisCalendar.bundleID == -1)
        return defaultMonth; //currently only developed for bundles TODO: add event, category, standard support.

    $.getJSON("/include/widgets/calendar/calendarRequests.asp",
            {
                action: 'initialBundleDate',
                iBundle: thisCalendar.bundleID,
            })
            .done(function (data) {
                try {
                    if (data.performancedates.length > 0) {
                        var firstDate = Number(String(data.performancedates).split("/")[0]) - 1;
                        thisCalendar.month = firstDate - 1; //to make this simple, we're using the showNextMonth() function, which means we need to set the month to 1 less than our target, as that function increments the month itself
                        thisCalendar.showNextMonth();
                    }else{
                        return defaultMonth;
                    }
                }catch(e){
                    console.log("getFirstDate returned invalid date. Default used");
                    console.log(e);
                    return defaultMonth;
                }
            })
            .fail(function (jqxhr, textStatus, error) {
                var err = textStatus + ", " + error;
                console.log("Request Failed: " + err);
            });
}
swDatepicker.prototype.fetchLocalDates = function () {
    //utliize storage to store months
    var CalendarExpireTime = new Date().getTime(); var isExpired = false; var datesData = "";
    var calendarIDString = this.calendarName + this.type + this.eventID + this.bundleID + "_" + this.activeMonth;
    try {
        //check for local storage support
        isExpired = CalendarExpireTime > Number(localStorage.getItem("CalendarExpireTime_" + calendarIDString));
        if (isExpired) {
            //item expired, clear local results
            localStorage.setItem("ShowareDates_" + calendarIDString, "");
            localStorage.setItem("CalendarExpireTime_" + calendarIDString, CalendarExpireTime + (1000 * 60 * 30));  //item information expires after 30 minutes
            return false;
        }
        localStorage.setItem("CalendarExpireTime_" + calendarIDString, CalendarExpireTime + (1000 * 60 * 30));  //item information expires after 30 minutes
        if (localStorage.getItem("ShowareDates_" + calendarIDString) != null && localStorage.getItem("ShowareDates_" + calendarIDString) != "") {
            return localStorage.getItem("ShowareDates_" + calendarIDString);
        } else {
            //date info not stored
            return false;
        }
    } catch (e) {
        return false;
    }
}
swDatepicker.prototype.storeDates = function (dateData) {
    var calendarIDString = this.calendarName + this.type + this.eventID + this.bundleID + "_" + this.activeMonth;
    try {
        localStorage.setItem("ShowareDates_" + calendarIDString, JSON.stringify(dateData));
    } catch (e) {
        //no local storage
    }
}

</script>
        <script type="text/javascript">
            if (typeof localStorage === 'object') {
                try {
                    localStorage.setItem('localStorage', 1);
                    localStorage.removeItem('localStorage');
                } catch (e) {
                    Storage.prototype._setItem = Storage.prototype.setItem;
                    Storage.prototype.setItem = function () { };
                    console.log("local storage not availalbe, data tracking limited");
                }
            }
            function persistDataLayer(layerName, pageVal) {
                var ShoWareExpTime = new Date().getTime(); var isExpired = false;

                try {
                    isExpired = ShoWareExpTime > Number(localStorage.getItem("swExpTime"));
                    if (isExpired) {
                        removeDataLayer();
                    }
                    localStorage.setItem("swExpTime", ShoWareExpTime + 1000 * 60 * 30);  //tag information expires after 30 minutes of inactivity

                    //grab anything we might have in storage=
                    var existVal = localStorage.getItem(layerName);
                    if (pageVal != "") {
                        //page val trumps all, store it and send it back
                        localStorage.setItem(layerName, pageVal);
                        return pageVal;
                    } else {
                        //page val was empty, so we'll try to pull a value out of local storage
                        if (existVal != "" && existVal != null && existVal != undefined && !isExpired) {
                            return existVal;
                        } else {
                            //no value exists, or the values stored have expired;
                            return "";
                        }
                    }
                } catch(e) {
                    //no local storage, or other error, we'll just return the page value. Calls to this function should assume the possibility of failure as local storage does not work on IOS devices with private browsing enabled.
                    return pageVal;
                }
            }
            function addDataLayer(layerName, setVal) {
                try {
                    //the data layer MUST be set up before the container is introduced.
                    //We will rely on future loads to address these variables as they are added after the pageload.
                    localStorage.setItem(layerName, setVal);
                    //push data to dataLayer so we can retrieve it with non-load events (clicks, changes, etc...)
                    dataLayer.push(layerName, setVal);
                }
                catch (e) {
                    //local storage failed, or the data layer was not available.
                }
            }
            function removeDataLayer() {
                //empty showare data layer from local storage.
                for (var i = localStorage.length - 1; i >= 0; i--) {
                    layerName = localStorage.key(i);
                    if (layerName.indexOf("Ticketing") > -1) {
                        localStorage.removeItem(layerName);
                    }
                }
            }
            function tryParse(jsonString) {
                if (jsonString == "" || jsonString == null || jsonString == undefined) {
                    return '';
                }
                try {
                    JSON.parse(jsonString);
                } catch (e) {
                    console.log(e);
                    return '';
                }
                return JSON.parse(jsonString);
            }
        </script>

        <script>
            dataLayer = [{
                'TicketingHasActivePerformances': 'True',
                'TicketingPage': 'bundleselect.asp',
                'TicketingEventID': persistDataLayer("TicketingEventID", ""),
                'TicketingBundleID': persistDataLayer("TicketingBundleID", "0"),
                'TicketingPerformanceID': persistDataLayer("TicketingPerformanceID", ""),
                'TicketingPerformanceCode': persistDataLayer("TicketingPerformanceCode", ""),
                'TicketingPerformanceDate': persistDataLayer("TicketingPerformanceDate", ""),
                'TicketingOrderID': persistDataLayer("TicketingOrderID", "0"),
                'TicketingNewCustomer': persistDataLayer("TicketingNewCustomer", ""),
                'TicketingCustomerID': "",
                'TicketingCustomerZipCode': persistDataLayer("TicketingCustomerZipCode", ""),
                'TicketingCustomerState': persistDataLayer("TicketingCustomerState", ""),
                'TicketingCustomerCountry': persistDataLayer("TicketingCustomerCountry", ""),
                'TicketingOrderTotal': persistDataLayer("TicketingOrderTotal", ""),
                'TicketingCoupon': persistDataLayer("TicketingCoupon", ""),
                'TicketingHasMixedBasket': persistDataLayer("TicketingHasMixedBasket", ""),
                'TicketingOrderSubTotal': persistDataLayer("TicketingOrderSubTotal", ""),
                'TicketingItemCount': persistDataLayer("TicketingItemCount", ""),
                'TicketingShippingMethod': persistDataLayer("TicketingShippingMethod", ""),
                'TicketingIsWillCall': persistDataLayer("TicketingIsWillCall", ""),
                'TicketingHeardAbout': persistDataLayer("TicketingHeardAbout", ""),
                'TicketingShippingTotal': persistDataLayer("TicketingShippingTotal", ""),
                'TicketingTaxTotal': persistDataLayer("TicketingTaxTotal", ""),
                'TicketingFeesTotal': persistDataLayer("TicketingFeesTotal", ""),
                'TicketingProcessingFee': persistDataLayer("TicketingProcessingFee", ""),
                'TicketingTicketFeesTotal': persistDataLayer("TicketingTicketFeesTotal", ""),
                'TicketingTicketItems': persistDataLayer("TicketingTicketItems", ""),
                'TicketingDonationItems': persistDataLayer("TicketingDonationItems", ""),
                'TicketingMembershipItems': persistDataLayer("TicketingMembershipItems", ""),
                'TicketingSalesChannel': persistDataLayer("TicketingSalesChannel", ""),
                'TicketingPaymentType': persistDataLayer("TicketingPaymentType", ""),
                'TicketingEventName': persistDataLayer("TicketingEventName", ""),
                'TicketingPerformanceName': persistDataLayer("TicketingPerformanceName", ""),
                'TicketingPromoterID': persistDataLayer("TicketingPromoterID", ""),
                'GAClientID': persistDataLayer("GAClientID", ""),
                'transactionId': 0,
                'transactionTotal': parseFloat(persistDataLayer("transactionTotal", "")),
                'transactionAffiliation' : 'Polynesian Cultural Center',
                'transactionTax': parseFloat(persistDataLayer("transactionTax", "")),
                'transactionShipping': parseFloat(persistDataLayer("transactionShipping", "")),
                'transactionProducts': tryParse(persistDataLayer("transactionProducts", ""))
            }];
        </script>
        
            <!-- CLIENT Google Tag Manager -->
            <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','GTM-MMK2L6H');</script>
            <!-- End CLIENT Google Tag Manager -->
        


    <script type="text/javascript">
        var simpleCacheBuster = {
            beforeLength: 0,
            afterLength: 0
        };

        simpleCacheBuster.beforeLength = document.cookie.length;
        simpleCacheBuster.afterLength = document.cookie.replace("ShowareVersion=newUI", " ").length;

        // If length is the same, then we haven't set this version cookie before, clear the cache.
        // If after length is smaller, then we have replaced the same version, do nothing.
        // After length shouldn't be greater, do nothing.
        if (simpleCacheBuster.beforeLength == simpleCacheBuster.afterLength) {
            document.cookie = "ShowareVersion=newUI";

            // This will force browser to reload all includes from server instead of cache.
            // Sadly, this doesn't work on Chrome due to a bug that they refuse to fix.
            // https://bugs.chromium.org/p/chromium/issues/detail?id=443462
            location.reload(true);
        }
    </script>

	<script language="JavaScript">
	    $(document).ready(function () {
	        var sessionKey;
	        sessionKey = '';
	        //v1Session variable declared in jq.js 
	        v1Session.setSessionKey(sessionKey);
	    });

	</script>
    <script type="text/javascript">
        /*
         * Replace all SVG images with inline SVG - allows for image modificcation via CSS
         */
        function extractIcons() {
            $('img.sw-icon').each(function () {
                var $img = $(this);
                var imgID = $img.attr('id');
                var imgClass = $img.attr('class');
                var imgURL = $img.attr('src');

                $.get(imgURL, function (data) {
                    // Get the SVG tag, ignore the rest
                    var $svg = jQuery(data).find('svg');

                    // Add replaced image's ID to the new SVG
                    if (typeof imgID !== 'undefined') {
                        $svg = $svg.attr('id', imgID);
                    }
                    // Add replaced image's classes to the new SVG
                    if (typeof imgClass !== 'undefined') {
                        $svg = $svg.attr('class', imgClass + ' replaced-svg');
                    }
                    // Remove any invalid XML tags as per http://validator.w3.org
                    $svg = $svg.removeAttr('xmlns:a');
                    // Replace image with new SVG
                    $img.replaceWith($svg);
                }, 'xml');
            });
        }
    </script>
	
    <script type="text/javascript">
        function getGAClientID() {
            try {
                return ga.getAll()[0].get('clientId');
            } catch (e) {
                return "0";
            }
        }
        function addGAClient(){
            var gaID = getGAClientID();
            if(gaID == "0"){
                //no analytics (unlikely), or analytics not loaded yet
                setTimeout(function(){addGAClient()}, 500);
            }else{
                try{
                    addDataLayer('GAClientID', gaID);
                }catch(e){
                    console.log("Failed to add data layer object: GAClientID:");
                    console.log(e);
                }
            }
        }
        addGAClient();

    </script>

	

    <!-- Comodo SSL Seal -->
    
        <script type="text/javascript">
            //<![CDATA[ 
            var tlJsHost = ((window.location.protocol == "https:") ? "https://secure.comodo.com/" : "http://www.trustlogo.com/"); document.write(unescape("%3Cscript src='" + tlJsHost + "trustlogo/javascript/trustlogo.js' type='text/javascript'%3E%3C/script%3E"));
            //]]>
        </script>
    

<script type="text/javascript">

    var swEnhancedEcommerce = {
        basketProducts: [],
        myImpressions: [],
        myProducts: [],

        //Building Up items to pass to analytics
        addImpressions: function (name, id, price, category, list, position) {
            //adds a product impression to myImpressions - represents a user being presented a specific product
            if (price != '') { //price is optional
                this.myImpressions.push(
                    {
                        'name': name,       // Name or ID is required.
                        'id': id,
                        'price': price,
                        'category': category,
                        'list': list,
                        'position': position
                    }
                );
            } else {
                this.myImpressions.push(
                    {
                        'name': name,       // Name or ID is required.
                        'id': id,
                        'category': category,
                        'list': list,
                        'position': position
                    }
                );
            }
        },

        addProducts: function (name, id, price, category, position) {
            //product clicks represent a product being selected. For showare currently this will always be a single product, but future use may require allowing users to select multiple products
            //this represents a click on a product, NOT adding a product to the basket
            if (price != '') { //price is optional

                this.myProducts.push(
                    {
                        'name': name,       // Name or ID is required.
                        'id': id,
                        'price': price,
                        'category': category,
                        'position': position
                    }
                );
            } else {
                this.myProducts.push(
                    {
                        'name': name,       // Name or ID is required.
                        'id': id,
                        'category': category,
                        'position': position
                    }
                );
            }
        },

        //object management functions
        clearImpressions: function(){
            this.myImpressions = [];
        },
        clearProducts: function () {
            this.myProducts = [];
        },

        //Passing data to analytics
        sendImpressions: function(){
            window.dataLayer.push({
                'event': 'impressionsPushed',
                'ecommerce': {
                    'impressions': this.myImpressions
                }
            });
        },
        sendProducts: function (list) {
            //list should be a string of the originator of the product click, for instance a performance list, event list, callout, or other
            window.dataLayer.push({
                'event': 'productClick',
                'ecommerce': {
                    'click': {
                        'actionField': { 'list': list },      // Optional list property.
                        'products': this.myProducts
                    }
                }
            });
        },
        sendDetails: function (name, id, category) {
            //tracks a user's view of product details
            window.dataLayer.push({
                'ecommerce': {
                    'detail': {
                        'products': [{
                            'name': name,         // Name or ID is required.
                            'id': id,
                            'category': category,
                        }]
                    }
                }
            });
        },

        sendAddToBasket: function(){
            //REQUIRES basketProducts populated via fetchBasketProducts or directly
            window.dataLayer.push({
                'event': 'addToCart',
                'ecommerce': {
                    'add': {                                // 'add' actionFieldObject measures.
                        'products': this.basketProducts
                    }
                }
            });
        },

        sendRemoveFromBasket: function (name, id, price, category, quantity, doUpdate) {
            //the item should be removed from the actual basket before this is called, as the basket is updated immediately
            window.dataLayer.push({
                'event': 'removeFromCart',
                'ecommerce': {
                    'remove': {                               // 'remove' actionFieldObject measures.
                        'products': [{                          //  removing a product to a shopping cart.
                            'name': name,
                            'id': id,
                            'price': price,
                            'category': category,
                            'quantity': quantity
                        }]
                    }
                }
            });
            if (doUpdate) {
                this.fetchBasketProducts();
            }
        },

        sendRemoveAllFromBasket: function () {
            //the item should be removed from the actual basket before this is called, as the basket is updated immediately
            window.dataLayer.push({
                'event': 'removeFromCart',
                'ecommerce': {
                    'remove': {                               // 'remove' actionFieldObject measures.
                        'products': this.basketProducts
                    }
                }
            });
            this.basketProducts = [];
        },

        //method to fetch basket - we should only call this if we intend to send products to analytics
        fetchBasketProducts: function (type, orderID) {
            if (typeof type === 'undefined') type = 'basket'; //defaults to grabbing basket items
            if (typeof orderID === 'undefined') orderID = 0;
            var fetchURL = "include/modules/enhancedEcommerceBasket.asp?type=" + type + "&orderid=" + orderID;

            try {
                $.ajax({
                    context: this,
                    url: fetchURL
                })
                .done(function (data) {
                    //note that we'll only have basket details if this method is called. Functions like sendAddToBasket, and sendPurchase will not function if this method has not completed.
                    try{
                        this.basketProducts = JSON.parse(data);
                    } catch (e) {
                        console.log(e);
                        this.basketProducts = [];
                    }
                });
                //grab the basket and store contents
            } catch (e) {
                console.log(e);
                return
            }
        },

        sendOrder: function (orderID, orderTotal, taxFees, shippingFees, couponCodes) {
            var fetchURL = "include/modules/enhancedEcommerceBasket.asp?type=order&orderid=" + orderID;
            orderProducts = [];

            try {
                $.ajax({
                    context: this,
                    url: fetchURL
                })
                .done(function (data) {
                    //note that we'll only have basket details if this method is called. Functions like sendAddToBasket, and sendPurchase will not function if this method has not completed.
                    try {
                        orderProducts = JSON.parse(data);
                    } catch (e) {
                        console.log(e);
                        orderProducts = [];
                    }
                    dataLayer.push({
                        'event': 'purchaseMade',
                        'ecommerce': {
                            'purchase': {
                                'actionField': {
                                    'id': orderID,                         // Transaction ID. Required for purchases and refunds.
                                    'affiliation': 'Online Ticketing',
                                    'revenue': orderTotal,                     // Total transaction value (incl. tax and shipping)
                                    'tax': taxFees,
                                    'shipping': shippingFees,
                                    'coupon': couponCodes
                                },
                                'products': orderProducts
                            }
                        }
                    });
                });
                //grab the basket and store contents
            } catch (e) {
                console.log(e);
                return
            }

            
        },

        // -------------------------------------------- CHECKOUT STEPS --------------------------------------------
        // 1. Basket Page "Checkout" Clicked
        // 2. login/guest/create
        // 3. Streamlined - select shipping method
        // 4. Streamlined - enter payment information
        // 5. Streamlined - complete clicked
        // 6. view order
        sendCheckoutStep: function(stepID, option){
            dataLayer.push({
                'event': 'checkout',
                'ecommerce': {
                    'checkout': {
                        'actionField': { 'step': stepID, 'option': option },
                        'products': this.basketProducts
                    }
                }
            });
        }

    }
</script> 
<script type="text/javascript">
    //---------------------------DATEPICKER---------------------------------
    function buildDatepicker(options) {
    //Calling this function should be sufficient to create a calendar within a designated div, with and
    //EX: headerDP = buildDatepicker({"calendarID":"headerCalendar","linkedInputID":"headerCalendarInput","isModal":false,"forceDates":true, "defaultDate": "{{Output date from server Here}}"}); <~ would create a calendar object for the calendar presented at #headerCalendar, and link it to #headerCalendarInput
    //most calendar methods are specific to the document the calendar resides on, and should be handled via the onChange event for the linked input
    //Available Options:
    //  calendarID (required)       == string, ID of calendar div
    //  linkedInput (required)      == string, ID of input which will change when a date is selected
    //  isModal                     == boolean, if true, calendar will be hidden, and display when the designated input recieves focus. If false, the calendar will be present and display as an inline block at all times.
    //  forceDates                  == boolean, if true only highlighted dates will be clickable
    //  defaultDate                 == string, mm/dd/yyyy date that calendar should start on (this will only represent the month displayed at the begining)
    //  type                        == string: defaults to "performancedates", which will add all visible performances
    //  eventID                     == integer: defaults to -1 which means no event. Other values will filter by events with that ID, allowing for a search of performance dates for a specific event only
    //
    //Methods:
    //  showDlg()/hideDlg()             : shows/hides modal calendars, no valid for non-modal calendars
    //  addHighlightDay(mm/dd/yyyy)     : adds a date (presented as a mm/dd/yyyy string) to the list of highlight dates for the calendar - REQUIRES HighlightDays() function call to visually represent this change on the calendar
    //  clearHihghlightDays()           : removes all stored highlight dates
    //  highlightDays()                 : adds highlight class to stored days, visually highlighting them ont he calendar.

    var myID = options.calendarID; //required
    var myLinkedInput = options.linkedInputID; //required
    var isModal = options.isModal || false;
    var forceDates = options.forceDates || false;
    var myDefault = new Date();
    if (options.defaultDate) {
        try{
            myDefault = new Date(options.defaultDate)
        } catch (e) {
            console.log("date no valid for calendar: " + myID);
            console.log(e);
        }
    }
    var type = options.type || "performancedates";
    var eventID = options.eventID || -1;
    var bundleID = options.bundleID || -1;
    var categoryID = options.CategoryID || -1;

    return new swDatepicker(myID, myLinkedInput, isModal, forceDates, myDefault, type, eventID, bundleID, categoryID)
}
function swDatepicker(id, target, modal, force, defaultDate, type, eventID, bundleID, categoryID) {

    this.$id = $('#' + id); // element to attach widget to
    this.$monthObj = this.$id.find('.month');
    this.$prev = this.$id.find('.bn_prev');
    this.$next = this.$id.find('.bn_next');
    this.$grid = this.$id.find('.cal');
    this.$target = $('#' + target); // div or text box that will receive the selected date string and focus (if modal)
    this.bModal = modal; // true if datepicker should appear in a modal dialog box.
    this.forceDateSelection = force; //if true, will only allow users to click on highlighted dates - see addHighlightDay()
    this.active = !modal;
    this.type = type;
    this.eventID = eventID;
    this.bundleID = bundleID;
    this.categoryID = categoryID;

    this.calendarName = id;

    this.monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
    'July', 'August', 'September', 'October', 'November', 'December'];

    this.dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

    this.dateObj = new Date();

    this.curYear = this.dateObj.getFullYear();
    this.year = defaultDate.getFullYear();

    this.curMonth = this.dateObj.getMonth();
    this.month = defaultDate.getMonth();
    this.getFirstDate(defaultDate.getMonth()); //update the month to the first performance ASAP

    this.curDate = this.dateObj.getDate();
    this.date = defaultDate.getDate();
    this.currentDate = (this.month == this.curMonth && this.year == this.curYear);
    this.activeMonth = (String(this.month + 1) + "/1/" + this.year)

    this.keys = {
        tab: 9,
        enter: 13,
        esc: 27,
        space: 32,
        pageup: 33,
        pagedown: 34,
        end: 35,
        home: 36,
        left: 37,
        up: 38,
        right: 39,
        down: 40
    };

    this.highlightDates = [];

    //determine first date, if needed
    

    // display the current month
    this.$monthObj.html(this.monthNames[this.month] + ' ' + this.year);

    // populate the calendar grid
    this.popGrid();

    // update the table's activedescdendant to point to the current day
    this.$grid.attr('aria-activedescendant', this.$grid.find('.today').attr('id'));

    this.bindHandlers();

    // hide dialog if in modal mode
    if (this.bModal == true) {
        this.$id.attr('aria-hidden', 'true');
        //show/hide functionality may vary based on use, so should be handled after the datepicker is created.
        //if we're on mobile, disable keyboard for the input:
        if ($(window).width() < 1024) {
            this.$target.attr("readonly", "true");
        }
    }
}

//
// popGrid() is a member function to populate the datepicker grid with calendar days
// representing the current month
//
// @return N/A
//
swDatepicker.prototype.popGrid = function () {

    var numDays = this.calcNumDays(this.year, this.month);
    var startWeekday = this.calcStartWeekday(this.year, this.month);
    var weekday = 0;
    var curDay = 1;
    var rowCount = 1;
    var $tbody = this.$grid.find('tbody');

    var gridCells = '\t<tr id="row1">\n';

    // clear the grid
    $tbody.empty();
    $('#msg').empty();

    // Insert the leading empty cells
    for (weekday = 0; weekday < startWeekday; weekday++) {

        gridCells += '\t\t<td class="empty">&nbsp;</td>\n';
    }

    // insert the days of the month.
    for (curDay = 1; curDay <= numDays; curDay++) {

        if (curDay == this.curDate && this.currentDate == true) {

            gridCells += '\t\t<td id="' + this.calendarName + '-day' + curDay + '" class="today" headers="row' +
            rowCount + ' ' + this.dayNames[weekday] + '" role="gridcell" aria-selected="false"><span class="calendar-day notranslate">' + curDay + '</span></td>';

        }
        else {
            gridCells += '\t\t<td id="' + this.calendarName + '-day' + curDay + '" headers="row' +
            rowCount + ' ' + this.dayNames[weekday] + '" role="gridcell" aria-selected="false"><span class="calendar-day notranslate">' + curDay + '</span></td>';
        }


        if (weekday == 6 && curDay < numDays) {
            // This was the last day of the week, close it out
            // and begin a new one
            gridCells += '\t</tr>\n\t<tr id="row' + rowCount + '">\n';
            rowCount++;
            weekday = 0;
        }
        else {
            weekday++;
        }
    }

    // Insert any trailing empty cells
    for (weekday; weekday < 7; weekday++) {

        gridCells += '\t\t<td class="empty">&nbsp;</td>\n';
    }

    gridCells += '\t</tr>';

    $tbody.append(gridCells);

    this.fetchDates();
}

//
// calcNumDays() is a member function to calculate the number of days in a given month
//
// @return (integer) number of days
//
swDatepicker.prototype.calcNumDays = function (year, month) {

    return 32 - new Date(year, month, 32).getDate();
}

//
// calcstartWeekday() is a member function to calculate the day of the week the first day of a
// month lands on
//
// @return (integer) number representing the day of the week (0=Sunday....6=Saturday)
//
swDatepicker.prototype.calcStartWeekday = function (year, month) {

    return new Date(year, month, 1).getDay();

} // end calcStartWeekday()

//
// showPrevMonth() is a member function to show the previous month
//
// @param (offset int) offset may be used to specify an offset for setting
//                      focus on a day the specified number of days from
//                      the end of the month.
// @return N/A
//
swDatepicker.prototype.showPrevMonth = function (offset) {
    // show the previous month
    if (this.month < 1) {
        this.month = 11;
        this.year--;
    }
    else {
        this.month--;
    }

    if (this.month != this.curMonth || this.year != this.curYear) {
        this.currentDate = false;
    }
    else {
        this.currentDate = true;
    }

    this.activeMonth = (String(this.month + 1) + "/1/" + this.year)

    // populate the calendar grid
    this.popGrid();

    this.$monthObj.html(this.monthNames[this.month] + ' ' + this.year);

    // if offset was specified, set focus on the last day - specified offset
    if (offset != null) {
        var numDays = this.calcNumDays(this.year, this.month);
        var day = 'day' + (numDays - offset);

        this.$grid.attr('aria-activedescendant', this.calendarName + '-' + day);
        $('#' + this.calendarName + '-' + day).addClass('focus').attr('aria-selected', 'true');
    }

} // end showPrevMonth()

//
// showNextMonth() is a member function to show the next month
//
// @param (offset int) offset may be used to specify an offset for setting
//                      focus on a day the specified number of days from
//                      the beginning of the month.
// @return N/A
//
swDatepicker.prototype.showNextMonth = function (offset) {

    // show the next month
    if (this.month == 11) {
        this.month = 0;
        this.year++;
    }
    else {
        this.month++;
    }

    if (this.month != this.curMonth || this.year != this.curYear) {
        this.currentDate = false;
    }
    else {
        this.currentDate = true;
    }

    this.activeMonth = (String(this.month + 1) + "/1/" + this.year)

    // populate the calendar grid
    this.popGrid();

    this.$monthObj.html(this.monthNames[this.month] + ' ' + this.year);

    // if offset was specified, set focus on the first day + specified offset
    if (offset != null) {
        var day = 'day' + offset;

        this.$grid.attr('aria-activedescendant', this.calendarName + '-' + day);
        $('#' + this.calendarName + '-' + day).addClass('focus').attr('aria-selected', 'true');
    }

} // end showNextMonth()

//
// showPrevYear() is a member function to show the previous year
//
// @return N/A
//
swDatepicker.prototype.showPrevYear = function () {

    // decrement the year
    this.year--;

    if (this.month != this.curMonth || this.year != this.curYear) {
        this.currentDate = false;
    }
    else {
        this.currentDate = true;
    }

    // populate the calendar grid
    this.popGrid();

    this.$monthObj.html(this.monthNames[this.month] + ' ' + this.year);

} // end showPrevYear()

//
// showNextYear() is a member function to show the next year
//
// @return N/A
//
swDatepicker.prototype.showNextYear = function () {

    // increment the year
    this.year++;

    if (this.month != this.curMonth || this.year != this.curYear) {
        this.currentDate = false;
    }
    else {
        this.currentDate = true;
    }

    // populate the calendar grid
    this.popGrid();

    this.$monthObj.html(this.monthNames[this.month] + ' ' + this.year);

} // end showNextYear()

//
// bindHandlers() is a member function to bind event handlers for the widget
//
// @return N/A
//
swDatepicker.prototype.bindHandlers = function () {

    var thisObj = this;

    ////////////////////// bind button handlers //////////////////////////////////
    this.$prev.click(function (e) {
        return thisObj.handlePrevClick(e);
    });

    this.$next.click(function (e) {
        return thisObj.handleNextClick(e);
    });

    this.$prev.keydown(function (e) {
        return thisObj.handlePrevKeyDown(e);
    });

    this.$next.keydown(function (e) {
        return thisObj.handleNextKeyDown(e);
    });

    ///////////// bind grid handlers //////////////

    this.$grid.keydown(function (e) {
        return thisObj.handleGridKeyDown(e);
    });

    this.$grid.keypress(function (e) {
        return thisObj.handleGridKeyPress(e);
    });

    this.$grid.focus(function (e) {
        return thisObj.handleGridFocus(e);
    });

    this.$grid.blur(function (e) {
        return thisObj.handleGridBlur(e);
    });

    this.$grid.delegate('td', 'click', function (e) {
        return thisObj.handleGridClick(this, e);
    });

} // end bindHandlers();

//
// handlePrevClick() is a member function to process click events for the prev month button
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handlePrevClick = function (e) {

    var active = this.$grid.attr('aria-activedescendant');

    if (e.ctrlKey) {
        this.showPrevYear();
    }
    else {
        this.showPrevMonth();
    }

    if (this.currentDate == false) {
        this.$grid.attr('aria-activedescendant', this.calendarName + '-day1');
    }
    else {
        this.$grid.attr('aria-activedescendant', active);
    }

    e.stopPropagation();
    return false;

} // end handlePrevClick()

//
// handleNextClick() is a member function to process click events for the next month button
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handleNextClick = function (e) {

    var active = this.$grid.attr('aria-activedescendant');

    if (e.ctrlKey) {
        this.showNextYear();
    }
    else {
        this.showNextMonth();
    }

    if (this.currentDate == false) {
        this.$grid.attr('aria-activedescendant', this.calendarName + '-day1');
    }
    else {
        this.$grid.attr('aria-activedescendant', active);
    }

    e.stopPropagation();
    return false;

} // end handleNextClick()

//
// handlePrevKeyDown() is a member function to process keydown events for the prev month button
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handlePrevKeyDown = function (e) {

    if (e.altKey) {
        return true;
    }

    switch (e.keyCode) {
        case this.keys.tab: {
            if (this.bModal == false || !e.shiftKey || e.ctrlKey) {
                return true;
            }

            this.$grid.focus();
            e.stopPropagation();
            return false;
        }
        case this.keys.enter:
        case this.keys.space: {
            if (e.shiftKey) {
                return true;
            }

            if (e.ctrlKey) {
                this.showPrevYear();
            }
            else {
                this.showPrevMonth();
            }

            e.stopPropagation();
            return false;
        }
    }

    return true;

} // end handlePrevKeyDown()

//
// handleNextKeyDown() is a member function to process keydown events for the next month button
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handleNextKeyDown = function (e) {

    if (e.altKey) {
        return true;
    }

    switch (e.keyCode) {
        case this.keys.enter:
        case this.keys.space: {

            if (e.ctrlKey) {
                this.showNextYear();
            }
            else {
                this.showNextMonth();
            }

            e.stopPropagation();
            return false;
        }
    }

    return true;

} // end handleNextKeyDown()

//
// handleGridKeyDown() is a member function to process keydown events for the datepicker grid
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handleGridKeyDown = function (e) {

    var $rows = this.$grid.find('tbody tr');
    var $curDay = $('#' + this.$grid.attr('aria-activedescendant'));
    var $days = this.$grid.find('td').not('.empty');
    var $curRow = $curDay.parent();

    if (e.altKey) {
        return true;
    }

    switch (e.keyCode) {
        case this.keys.tab: {

            if (this.bModal == true) {
                if (e.shiftKey) {
                    this.$next.focus();
                }
                else {
                    this.$prev.focus();
                }
                e.stopPropagation()
                return false;
            }
            break;
        }
        case this.keys.enter:
        case this.keys.space: {

            if (e.ctrlKey) {
                return true;
            }

            // update the target box
            this.$target.val((this.month + 1) + '/' + $curDay.text() + '/' + this.year).change();

            // fall through
        }
        case this.keys.esc: {
            // dismiss the dialog box
            this.hideDlg();

            e.stopPropagation();
            return false;
        }
        case this.keys.left: {

            if (e.ctrlKey || e.shiftKey) {
                return true;
            }

            var dayIndex = $days.index($curDay) - 1;
            var $prevDay = null;

            if (dayIndex >= 0) {
                $prevDay = $days.eq(dayIndex);

                $curDay.removeClass('focus').attr('aria-selected', 'false');
                $prevDay.addClass('focus').attr('aria-selected', 'true');

                this.$grid.attr('aria-activedescendant', $prevDay.attr('id'));
            }
            else {
                this.showPrevMonth(0);
            }

            e.stopPropagation();
            return false;
        }
        case this.keys.right: {

            if (e.ctrlKey || e.shiftKey) {
                return true;
            }

            var dayIndex = $days.index($curDay) + 1;
            var $nextDay = null;

            if (dayIndex < $days.length) {
                $nextDay = $days.eq(dayIndex);
                $curDay.removeClass('focus').attr('aria-selected', 'false');
                $nextDay.addClass('focus').attr('aria-selected', 'true');

                this.$grid.attr('aria-activedescendant', $nextDay.attr('id'));
            }
            else {
                // move to the next month
                this.showNextMonth(1);
            }

            e.stopPropagation();
            return false;
        }
        case this.keys.up: {

            if (e.ctrlKey || e.shiftKey) {
                return true;
            }

            var dayIndex = $days.index($curDay) - 7;
            var $prevDay = null;

            if (dayIndex >= 0) {
                $prevDay = $days.eq(dayIndex);

                $curDay.removeClass('focus').attr('aria-selected', 'false');
                $prevDay.addClass('focus').attr('aria-selected', 'true');

                this.$grid.attr('aria-activedescendant', $prevDay.attr('id'));
            }
            else {
                // move to appropriate day in previous month
                dayIndex = 6 - $days.index($curDay);

                this.showPrevMonth(dayIndex);
            }

            e.stopPropagation();
            return false;
        }
        case this.keys.down: {

            if (e.ctrlKey || e.shiftKey) {
                return true;
            }

            var dayIndex = $days.index($curDay) + 7;
            var $prevDay = null;

            if (dayIndex < $days.length) {
                $prevDay = $days.eq(dayIndex);

                $curDay.removeClass('focus').attr('aria-selected', 'false');
                $prevDay.addClass('focus').attr('aria-selected', 'true');

                this.$grid.attr('aria-activedescendant', $prevDay.attr('id'));
            }
            else {
                // move to appropriate day in next month
                dayIndex = 8 - ($days.length - $days.index($curDay));

                this.showNextMonth(dayIndex);
            }

            e.stopPropagation();
            return false;
        }
        case this.keys.pageup: {
            var active = this.$grid.attr('aria-activedescendant');


            if (e.shiftKey) {
                return true;
            }


            if (e.ctrlKey) {
                this.showPrevYear();
            }
            else {
                this.showPrevMonth();
            }

            if ($('#' + active).attr('id') == undefined) {
                var lastDay = 'day' + this.calcNumDays(this.year, this.month);
                $('#' + this.calendarName + '-' + lastDay).addClass('focus').attr('aria-selected', 'true');
            }
            else {
                $('#' + this.calendarName + '-' + active).addClass('focus').attr('aria-selected', 'true');
            }

            e.stopPropagation();
            return false;
        }
        case this.keys.pagedown: {
            var active = this.$grid.attr('aria-activedescendant');


            if (e.shiftKey) {
                return true;
            }

            if (e.ctrlKey) {
                this.showNextYear();
            }
            else {
                this.showNextMonth();
            }

            if ($('#' + active).attr('id') == undefined) {
                var lastDay = 'day' + this.calcNumDays(this.year, this.month);
                $('#' + this.calendarName + '-' + lastDay).addClass('focus').attr('aria-selected', 'true');
            }
            else {
                $('#' + this.calendarName + '-' + active).addClass('focus').attr('aria-selected', 'true');
            }

            e.stopPropagation();
            return false;
        }
        case this.keys.home: {

            if (e.ctrlKey || e.shiftKey) {
                return true;
            }

            $curDay.removeClass('focus').attr('aria-selected', 'false');

            $('#' + this.calendarName + '-day1').addClass('focus').attr('aria-selected', 'true');

            this.$grid.attr('aria-activedescendant', this.calendarName + '-day1');

            e.stopPropagation();
            return false;
        }
        case this.keys.end: {

            if (e.ctrlKey || e.shiftKey) {
                return true;
            }

            var lastDay = 'day' + this.calcNumDays(this.year, this.month);

            $curDay.removeClass('focus').attr('aria-selected', 'false');

            $('#' + this.calendarName + '-' + lastDay).addClass('focus').attr('aria-selected', 'true');

            this.$grid.attr('aria-activedescendant', this.calendarName + '-' + lastDay);

            e.stopPropagation();
            return false;
        }
    }

    return true;

} // end handleGridKeyDown()

//
// handleGridKeyPress() is a member function to consume keypress events for browsers that
// use keypress to scroll the screen and manipulate tabs
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handleGridKeyPress = function (e) {

    if (e.altKey) {
        return true;
    }

    switch (e.keyCode) {
        case this.keys.tab:
        case this.keys.enter:
        case this.keys.space:
        case this.keys.esc:
        case this.keys.left:
        case this.keys.right:
        case this.keys.up:
        case this.keys.down:
        case this.keys.pageup:
        case this.keys.pagedown:
        case this.keys.home:
        case this.keys.end: {
            e.stopPropagation();
            return false;
        }
    }

    return true;

} // end handleGridKeyPress()

//
// handleGridClick() is a member function to process mouse click events for the datepicker grid
//
// @input (id obj) e is the id of the object triggering the event
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) false if consuming event, true if propagating
//
swDatepicker.prototype.handleGridClick = function (id, e) {
    var $cell = $(id);

    if ($cell.is('.empty')) {
        return true;
    }

    this.$grid.find('.focus').removeClass('focus').attr('aria-selected', 'false');
    $cell.addClass('focus').attr('aria-selected', 'true');
    this.$grid.attr('aria-activedescendant', $cell.attr('id'));

    var $curDay = $('#' + this.$grid.attr('aria-activedescendant'));

    // update the target box
    if (!this.forceDateSelection || $cell.hasClass("highlight-day")) {
        this.$target.val((this.month + 1) + '/' + $curDay.text() + '/' + this.year).change();

        // dismiss the dialog box
        this.hideDlg();
    }
    e.stopPropagation();
    return false;

} // end handleGridClick()

//
// handleGridFocus() is a member function to process focus events for the datepicker grid
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) true
//
swDatepicker.prototype.handleGridFocus = function (e) {
    var active = this.$grid.attr('aria-activedescendant');

    if ($('#' + active).attr('id') == undefined) {
        var lastDay = 'day' + this.calcNumDays(this.year, this.month);
        $('#' + lastDay).addClass('focus').attr('aria-selected', 'true');
    }
    else {
        $('#' + active).addClass('focus').attr('aria-selected', 'true');
    }

    return true;

} // end handleGridFocus()

//
// handleGridBlur() is a member function to process blur events for the datepicker grid
//
// @input (e obj) e is the event object associated with the event
//
// @return (boolean) true
//
swDatepicker.prototype.handleGridBlur = function (e) {
    $('#' + this.$grid.attr('aria-activedescendant')).removeClass('focus').attr('aria-selected', 'false');

    return true;

} // end handleGridBlur()

//
// showDlg() is a member function to show the datepicker and give it focus. This function is only called if
// the datepicker is used in modal dialog mode.
//
// @return N/A
//
swDatepicker.prototype.showDlg = function () {
    if (!this.bModal)
        return;

    var thisObj = this;
    var thisNode = this.$id;

    this.highlightDays();

    this.active = true;

    //prevent calendar from pushing out of the right side of the window
    if (thisNode.parent()[0].getBoundingClientRect().left > (window.innerWidth / 2))
        thisNode.addClass("right-side");

    $(".content-wrap").bind('click', function (e) {
        if (!thisNode[0].contains(e.target) && e.target != thisObj.$target[0]) {
            thisObj.hideDlg();
        }
    });

    // show the dialog
    this.$id.attr('aria-hidden', 'false');

    this.$grid.focus();

} // end showDlg()

//
// hideDlg() is a member function to hide the datepicker and remove focus. This function is only called if
// the datepicker is used in modal dialog mode.
//
// @return N/A
//
swDatepicker.prototype.hideDlg = function () {
    if (!this.bModal)
        return;
    
    this.active = false;
    var thisNode = this.$id;

    // unbind the modal event sinks
    $(document).unbind('click');

    // hide the dialog
    this.$id.attr('aria-hidden', 'true');

    // set focus on the focus target
    //this.$target.focus();

} // end showDlg()

//function to highlight days with performances or valid information
//to prevent rewriting the calendar each time a date is added, popGrid() should be called after all dates have been added
swDatepicker.prototype.addHighlightDay = function (date) {
    var datesplit = String(date).split("/");
    if (datesplit.length != 3) {
        //date didn't come in in m/d/yyyy format, kick it back in the console
        console.log("invalid date sent, datepicker accepts m/d/yyyy only - " + date);
        console.log(date);
        return;

    }
    this.highlightDates.push(date);

    if (parseInt(datesplit[0]) - 1 == this.month && parseInt(datesplit[2]) == this.year) {
        $("#" + this.calendarName + "-day" + datesplit[1]).addClass("highlight-day");
    }
}
swDatepicker.prototype.clearHighlightDays = function () {
    this.highlightDates = [];
    this.highlightDays();
}
//highlights all days in the highlightDates array
swDatepicker.prototype.highlightDays = function () {
    $("#" + this.calendarName + " .highlight-day").removeClass("highlight-day");
    var curYear = this.year;
    var curMonth = this.month;
    var calName = this.calendarName;
    var IEFix = new RegExp(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g);

    this.highlightDates.forEach(function (o, i, a) {

        var datesplit = o.split("/");
        if (parseInt(datesplit[0].replace(IEFix, '')) - 1 == parseInt(curMonth) && parseInt(datesplit[2].replace(IEFix, '')) == parseInt(curYear)) {
            $("#" + calName + "-day" + datesplit[1].replace(IEFix, '')).addClass("highlight-day");
        }
    });
}
swDatepicker.prototype.fetchDates = function(){
    var thisCalendar = this;
    var haveDates = thisCalendar.fetchLocalDates();
    if (thisCalendar.categoryID >= 0)
        haveDates = false;
    this.clearHighlightDays();
    if(haveDates){
        //valid local dates stored
        try{
            haveDates = JSON.parse(haveDates);
            if (haveDates.length > 0) {
                haveDates.forEach(function(o){
                    thisCalendar.addHighlightDay(o);
                })
                thisCalendar.highlightDays();
            }
        } catch (e) {
            console.log("Failed to grab dates. Date object not valid: " + haveDates);
            console.log(e);
        }
    } else {
        $.getJSON("/include/widgets/calendar/calendarRequests.asp",
            {
                action: thisCalendar.type,
                calMonth: thisCalendar.activeMonth,
                iEvent: thisCalendar.eventID,
                iBundle: thisCalendar.bundleID,
                iCategory : thisCalendar.categoryID
            })
            .done(function (data) {
                thisCalendar.storeDates(data.performancedates);
                try {
                    if (data.performancedates.length > 0) {
                        data.performancedates.forEach(function (o) {
                            thisCalendar.addHighlightDay(o);
                        })
                        thisCalendar.highlightDays();
                    }
                } catch (e) {
                    console.log("Failed to grab dates. Date object not valid: " + haveDates);
                    console.log(e);
                }
            })
            .fail(function (jqxhr, textStatus, error) {
                var err = textStatus + ", " + error;
                console.log("Request Failed: " + err);
            });
    }
}
swDatepicker.prototype.getFirstDate = function(defaultMonth){
    var thisCalendar = this;
    //this should only happen once on calendar load - currently only enabled for bundles
    if(thisCalendar.bundleID == 0 || thisCalendar.bundleID == -1)
        return defaultMonth; //currently only developed for bundles TODO: add event, category, standard support.

    $.getJSON("/include/widgets/calendar/calendarRequests.asp",
            {
                action: 'initialBundleDate',
                iBundle: thisCalendar.bundleID,
            })
            .done(function (data) {
                try {
                    if (data.performancedates.length > 0) {
                        var firstDate = Number(String(data.performancedates).split("/")[0]) - 1;
                        thisCalendar.month = firstDate - 1; //to make this simple, we're using the showNextMonth() function, which means we need to set the month to 1 less than our target, as that function increments the month itself
                        thisCalendar.showNextMonth();
                    }else{
                        return defaultMonth;
                    }
                }catch(e){
                    console.log("getFirstDate returned invalid date. Default used");
                    console.log(e);
                    return defaultMonth;
                }
            })
            .fail(function (jqxhr, textStatus, error) {
                var err = textStatus + ", " + error;
                console.log("Request Failed: " + err);
            });
}
swDatepicker.prototype.fetchLocalDates = function () {
    //utliize storage to store months
    var CalendarExpireTime = new Date().getTime(); var isExpired = false; var datesData = "";
    var calendarIDString = this.calendarName + this.type + this.eventID + this.bundleID + "_" + this.activeMonth;
    try {
        //check for local storage support
        isExpired = CalendarExpireTime > Number(localStorage.getItem("CalendarExpireTime_" + calendarIDString));
        if (isExpired) {
            //item expired, clear local results
            localStorage.setItem("ShowareDates_" + calendarIDString, "");
            localStorage.setItem("CalendarExpireTime_" + calendarIDString, CalendarExpireTime + (1000 * 60 * 30));  //item information expires after 30 minutes
            return false;
        }
        localStorage.setItem("CalendarExpireTime_" + calendarIDString, CalendarExpireTime + (1000 * 60 * 30));  //item information expires after 30 minutes
        if (localStorage.getItem("ShowareDates_" + calendarIDString) != null && localStorage.getItem("ShowareDates_" + calendarIDString) != "") {
            return localStorage.getItem("ShowareDates_" + calendarIDString);
        } else {
            //date info not stored
            return false;
        }
    } catch (e) {
        return false;
    }
}
swDatepicker.prototype.storeDates = function (dateData) {
    var calendarIDString = this.calendarName + this.type + this.eventID + this.bundleID + "_" + this.activeMonth;
    try {
        localStorage.setItem("ShowareDates_" + calendarIDString, JSON.stringify(dateData));
    } catch (e) {
        //no local storage
    }
}

</script>
	<script type="text/javascript" src="//qa-pcc.showare.net/include/select2.min.js"></script>
</head>

<body class="body-class body-en default-font">

	
            <!-- CLIENT Google Tag Manager -->
            <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MMK2L6H"
            height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
            <!-- End CLIENT Google Tag Manager -->
        
<div style="position:relative;">
<button class="skip-nav" title="Skip to Main Content">Skip to Main Content</button>
</div>
<script type="text/javascript">
	$(function(){
		$(".main-container").attr("tabindex", 0);
	})
	$(".skip-nav").on("click", function(){
		console.log("s");
		$(".main-container").focus();
	});
</script>


    <div id="page-wrap"><!--Main Page Wrap - Ends in HTMLfooter-->
	
	<!--DEMO TEXT-->
	<div id="demo-div">
		<span>Demo site. No real Tickets are sold.</span>
</div>
	<!--END DEMO TEXT END-->
	
        <!-- BEGIN Mobile Navigation BEGIN -->
		<nav class="navigation sw-nav mobile-only">
            <i id="menu-icon" class="sw-icon-menu" style="display:inline-block;" onclick="actMenu();hideWidgets();"></i>
            <div class="tab-nav-wrap">
                
                <a class="tab-nav" HREF="https://qa-pcc.showare.net/myaccount.asp?gifrompage=1&gitopage=1">my account</a>
            </div>
            <ul id="mobile-menu" onclick="actMenu();">
                    <!--<li><a HREF="/">home</a></li>       <!--CLIENT Home URL-->
                    <li><a HREF="https://qa-pcc.showare.net/default.asp">Ticketing Home</a></li>
                    <li class="mobile-only"><a HREF="https://qa-pcc.showare.net/myaccount.asp?gifrompage=1&gitopage=1">my account</a></li>
                    <li class="sw-sep mobile-only"></li>
                    
                    <li class="sw-sep"></li>
                    <li><a HREF="https://qa-pcc.showare.net/basket.asp">shopping cart</a></li>
                    
                    <li class="sw-sep"></li>
                    <li><a onclick="actMenu();hideWidgets();">close</a></li>
                </ul>
            <a style="color:inherit;" href="http://qa-pcc.showare.net/basket.asp"><i class="sw-icon-basket" style="float:right;"></i></a>
            
        </nav>
        <!--END Mobile Navigation END -->
        <header class="mobile-header mobile-only">
            <!--custom branding location for mobile -->
            <!--Header Ads can be placed here if client desires:
            
            -->
			<a href="https://www.polynesia.com"><img src="/images/polynesia-logo.png"  alt="Polynesian Cultural Center" border="0"><h1>Polynesian Cultural Center</h1></a>
        </header>
        <script type="text/javascript">
            $(function () {
                $(".control-box").append("<a class='close-widget mobile-only' onclick='hideWidgets()'>close</a>");
            })
       </script>
	
    <div class="no-mobile head-band clear">
		    <div id="google_translate_element" style="float:left;"></div><script type="text/javascript">
			/*
                                                 function googleTranslateElementInit() {
                                                     new google.translate.TranslateElement({ pageLanguage: 'en', layout: google.translate.TranslateElement.InlineLayout.SIMPLE }, 'google_translate_element');
												 }
			*/
</script><script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

        <ul class="showare-nav band-nav">
			
			          
			
			    <li><a HREF="http://qa-pcc.showare.net/basket.asp">Shopping Cart</a></li>
			
		    
        </ul>
    </div>
	<header class="head-wrap no-mobile">
        <!--This header will not be present on mobile. Use the mobile header area if a branding location for mobile is required.-->
		<div class="head-inner center-div site-width">
		  <div class="logo-container">	
			<a href="https://www.polynesia.com"><img src="/images/polynesia-logo.png"  alt="Polynesian Cultural Center" border="0"><h1>Polynesian Cultural Center</h1></a>
          </div> 
		  
		  	  
		  <div class="clear-float clear"></div>
		</div><!--END head-inner END-->
	</header><!--END head-wrap END-->
	<div class="blue-down-header no-mobile"></div>

	

	<!--MAIN BODY-->
	<div class="content-wrap"><!--Main Content Wrap - this and content-inner end in HTMLfooter-->
		<div class="content-inner center-div site-width">
            
			<!--LEFT SIDE-->
			<div class="control-wrap hide-wrap">
					
				
				<div class="ads-control">
					<center>
					<img class='ad-image' src=/AdsUPLImage/blank.gif width=1 height=1 border=0 alt=><img class='ad-image' src=/AdsUPLImage/blank.gif width=1 height=1 border=0 alt=><img class='ad-image' src=/AdsUPLImage/blank.gif width=1 height=1 border=0 alt=><img class='ad-image' src=/AdsUPLImage/blank.gif width=1 height=1 border=0 alt=><img class='ad-image' src=/AdsUPLImage/blank.gif width=1 height=1 border=0 alt=><img class='ad-image' src=/AdsUPLImage/blank.gif width=1 height=1 border=0 alt=><img class='ad-image' src=/AdsUPLImage/blank.gif width=1 height=1 border=0 alt=><img class='ad-image' src=/AdsUPLImage/blank.gif width=1 height=1 border=0 alt=><img class='ad-image' src=/AdsUPLImage/blank.gif width=1 height=1 border=0 alt=><img class='ad-image' src=/AdsUPLImage/blank.gif width=1 height=1 border=0 alt=>
					</center>
				</div>					
				
			</div><!--END control-wrap END-->
			<!--END LEFT SIDE-->

			<div id="epImage2"></div>

			<div class="main-container ">
				<!-- Main Area -->
				
				<!-- end HTMLheader.asp -->

<script type="text/javascript">
    var sessionKey = '';
</script>


<link rel="stylesheet" href="/include/font-awesome/css/font-awesome.min.css?v=2" />
<div id="BundleMainWrap">
    <style type="text/css" scoped>
        #demo-div{display:none!important;}
        #BundleMainWrap *
        {
            box-sizing: border-box;
        }
        #BundleMainWrap
        {
            min-height: 400px;
        }
        #BundleName{
            margin-top:0px;
        }
        #BundleMainWrap .section-label{
            display:block;
            opacity:0.8;
            font-weight:bold;
            padding-bottom:10px;
        }
         #BundlePartySizeWrap, #BundleSearchFilterWrap{
             width:30%;
             float:left;
         }
         .single-day-bundle #BundlePartySizeWrap{
             margin-right:10px;
         }
         
            #BundlePartySizeWrap{display:none!important;}
         
         #UniformGoButton{
             width:13%;
             right:1%;
             top:35px;
             position:absolute;
         }
         #BundlePricingWrap{
             clear:both;
             position:relative;
             padding-right:15%;
         }
         .single-day-bundle #BundlePricingWrap{
            float:left;
            clear:none;
            width: 73%;
            margin-left:2%
        }
         #UniformPriceCodesContainer{
             display:flex;
             flex-flow:row wrap;
         }
         #UniformPriceCodesContainer .input-with-incremental-buttons{
             padding-bottom:0px;
         }
        .uniform-price-code-control{
             min-width:50%;
             padding-right:10px;
             padding-bottom:10px;
         }
        #BundleMainWrap .input-with-incremental-buttons .button
        {
            margin:0px!important;
        }
        #BundleDateRangeWrap
        {
            width: 69%;
            float:right;
        }
        .single-day-bundle #BundleDateRangeWrap{
            float:left;
            width:25%;
        }
        .uniform-purchase-bundle:not(.single-day-bundle) #BundleDateRangeWrap{
            width:30%;
            float:left;
        }
        .uniform-purchase-bundle:not(.single-day-bundle) #BundlePricingWrap{
            float:right;
            width:69%;
            clear:none!important;
        }
        #BundleMainWrap .step-enum{
            margin:-5px;
            margin-right:1em;
            display:none;
        }
        #BundleMainWrap .event-header, #BundleMainWrap .performance-header, #BundleMainWrap .date-header
        {
            display:block;
        }
        #BundleItemsWrap
        {
            display: none;
        }
        #BundleItemsContainer .date-header, #BundleItemsContainer .event-container-header
        {
            font-size:1.8em;
            font-weight:bold;
            opacity:0.9;
            line-height:2em;
            display:block;
            margin-top:1em;
        }
        #BundleItemsContainer .event-date-range{
            font-weight: bold;
            display: block;
            margin-bottom: .5em;
        }
        #BundleItemsContainer .event-header .event-header-date:before{
            content: ' - ';
        }
        #BundleItemsContainer .bundle-event-item
        {
            padding:.5em 0;
            border-bottom:1px solid #f1f1f1;
        }
        #BundleItemsContainer .event-header
        {
            font-size:1.5em;
            opacity:0.9;
            line-height:2em;
            
            color:#337ab7;
            transition:color .4s;
        }
        #BundleItemsContainer .bundle-event-item.sold-out{
            pointer-events:none;
            opacity:0.5;
        }
        #BundleItemsContainer .bundle-event-item.sold-out .event-header .fa{
            opacity:0;
        }
        #BundleItemsContainer .bundle-event-item.sold-out .event-header:after{
            content:"Sold Out";
            color:#c00;
            font-weight:bold;
            float:right;
        }
        #BundleItemsContainer .bundle-event-item .bundle-venue-info{
            font-weight:bold;
            font-size:1.2em;
            opacity:0.8;
            padding:.5em 0;
        }
        #BundleItemsContainer .bundle-event-item:not(.active) .event-header:hover{
            color:#1565C0;
            cursor:pointer;
            background:RGBA(125,125,125,0.05);
        }
            #BundleItemsContainer .event-header .fa
            {
                margin-right:.5em;
                transition:transform .4s;
            }
            #BundleItemsContainer .bundle-event-item.active .event-header .fa
            {
                transform:rotate(180deg);
            }
        #BundleItemsContainer .pc-selected-indicator
        {
            float: right;
            font-size:.75em;
            line-height:1.75em;
            display: inline-block;
            margin: .5em .5em;
            margin-bottom:.25em;
            margin-right:0px;
            padding: 0 1em;
            background: #337ab7;
            border-radius: 2em;
            color: #fff;
        }
        #BundleItemsContainer .required-indicator
        {
            float: right;
            color: #337ab7;
            font-size: .75em;
            border: 1px solid #337ab7;
            padding: 0px 1em;
            border-radius: 4px;
            line-height: 1.8em;
            margin-top: .5em;
            margin-left:1em;
        }
        #BundleItemsContainer .bundle-event-item-contents
        {
            display:none;
            clear:both;
        }
        #BundleItemsContainer .bundle-event-item-times, #BundleItemsContainer .bundle-event-item-seatmap-image{
            width:50%;
            float:left;
            clear:left;
            padding:1em 0;
            flex-wrap:wrap;
            align-content: space-between;
        }
        #BundleItemsContainer .bundle-event-item-times
        {
            display: flex;
        }
        #BundleItemsContainer .bundle-event-item-times .button-time{
            margin-right:1em;
            border:1px solid transparent;
            min-width:130px;
        }
        #BundleItemsContainer .bundle-event-item-times .button-time.active{
            background: #5cb85c;
            border: 1px solid #4cae4c;
            color: #fff;
        }
        #BundleItemsContainer .bundle-event-item-prices{
            float:right;
            width:40%;
            padding-left:20%;
        }
        #BundleItemsContainer .price-category-wrap{
            position:relative;
            padding-top:34px;
            display:none;
        }
        #BundleItemsContainer .price-category-wrap.active
        {
            display:block;
        }
        #BundleItemsContainer .price-category-wrap.sold-out.disabled{
            opacity:0.5;
            pointer-events:none;
        }
        #BundleItemsContainer .bundle-price-code-wrap{
            position:relative;
            padding-bottom:.5em;
        }
        #BundleItemsContainer .price-code-name-label, #BundleItemsContainer .price-category-header{
            position:absolute;
            width:150%;
            right:100%;
            padding-right:1em;
            top:0px;
            text-align:right;
            font-weight:bold;
            line-height:34px;
            opacity:.8;
        }
        #BundleItemsContainer .price-code-name-label{
            line-height:1.1em;
            margin-top:8px;/*this value may change with varying font sizes, and font styles*/
        }
        #BundleItemsContainer .price-category-header{
            font-weight:400;
            font-style:italic;
        }
        #BundleTray{
            position:fixed;
            z-index:98;
            transition:bottom 600ms cubic-bezier(0.165, 0.84, 0.44, 1);
            width:90%;
            left:5%;
            right:5%;
            bottom:-100%;
            box-sizing:border-box;
            padding:1em;
            padding-bottom:4em;
            background:#E3F2FD;
            color:#1976D2;
            border:1px solid #BBDEFB;
            border-radius:4px;
        }
            #BundleTray.hide
            {
                transition: bottom 600ms cubic-bezier(0.895, 0.03, 0.685, 0.22);
            }
            #BundleTray #BundleTrayInfo
            {
                float:left;
                width:60%;
                padding:.5em;
            }
            #BundleTray #BundleTrayContinue
            {
                float:right;
                width:40%;
                padding:.5em;
                text-align:right;
            }
        #BundleTray .sw-button-primary.disabled
        {
            opacity:.4;
        }
        #BundleContinueButton
        {
            width:100%;
            font-size:1.2em;
        }
        #AddOnContinueButton
        {
            float: right;
        }
        #Loading{
            font-size:2em;
            text-align:center;
            padding:1em 2em;
            border-radius:4px;
            box-shadow:2px 2px 5px RGBA(0,0,0,0.4);
            display:inline-block;
        }
        #Loading .fa{
            margin-right:1em;
        }
        #BundleTotalWrap{
            float:right;
            padding:1em 2em;
            border-radius:4px;
            background:RGBA(0,0,0,0.025);
        }
        #BundleTotalWrap #BundleTotalQty, #BundleTotalWrap #BundleTotaPrice{
            text-align:right;
        }
        #BundleFiltersWrap{
            clear:both;
        }
        .bundle-event-description{
            padding:.5em 0;
        }
        .bundle-event-image{
            float:right;
            max-width:50%;
            border-radius:3px;
            box-shadow:1px 2px 4px RGBA(0,0,0,0.2);
            margin-left:2em;
        }
        .bundle-event-container{
            transition:opacity .4s;
        }
        .bundle-event-container .event-container-header{
            transition:margin-top .4s;
        }
        .bundle-event-container.no-results .event-container-header{
            margin-top:0!important;
        }

        .bundle-event-container.no-results{
            opacity:0.5;
        }
        .bundle-event-container .bundle-event-item, .bundle-event-container.no-results .bundle-event-description{
            display:none;
        }
        .event-performances-display-button .fa{
            margin-right:.5em;
            transition:transform .4s;
        }
        .event-performances-display-button.on .fa{
            transform:rotate(180deg);
        }
        .bundle-seatmap-image
        {
            max-width: 100%;
        }
        .price-category-available-warning {
            position: absolute;
            bottom: 10px;
            right: 105%;
            padding: 10px;
            display: block;
            border: 1px solid #a00;
            border-radius: 4px;
            background: #fee;
            color: #a00;
            font-weight: bold;
            box-shadow: 3px 3px 4px RGBA(0,0,0,0.1);
            animation-name:available-warning;
            animation-duration:.6s;
            text-align:center;
            width:20em;
        }
        #BundleUpgradeTray{
            position: fixed;
            top: 5em;
            right: -105%;
            width: 40%;
            background: #E3F2FD;
            color: #1976D2;
            border: 1px solid #BBDEFB;
            padding: 1.2em;
            border-radius: 4px;
            z-index: 999;
            transition: right .6s ease-in-out;
        }
        #BundleUpgradeTray.show{
            right:-1px;
        }
        .old-price{
            color:#a66;
            margin-left:1em;
            position:relative;
            display:inline-block;
        }
        .price-code-name-label span.old-price:after{
            content:''!important;
            display:block;
            border-top:2px solid #a66;
            position:absolute;
            width: 120%;
            top: 45%;
            left: -10%;
        }
        .new-price{
            color:#060;
            margin-left:1em;
        }
        .pc-select-button{font-size:1.25em;position:absolute;top:0px;right:0px;}
        .pc-select-button .fa{margin-right:.5em;display:none;}
        .pc-select-button:not(.selected) .fa.fa-square-o{display:inline-block;}
        .pc-select-button.selected .fa.fa-check-square{display:inline-block;}
        .pc-select-button.selected{background:#0a0;}
        @keyframes available-warning{
            0% {right:10%; opacity:0;}
            100% {right:105%; opacity:1;}
        }
        
        @media (max-width: 1024px)
        {
            .price-category-available-warning
            {
                bottom:auto;
                right:0px;
                top:-20px;
            }
            @keyframes available-warning{
                0% {top:-40px; opacity:0;}
                100% {top:-20px; opacity:1;}
            }
            #BundleItemsContainer .bundle-event-item-seatmap-image
            {
                width: 100%;
                float:none;
            }
            .bundle-event-image
            {
                float:none;
                max-width:100%;
                margin:0;
                margin-bottom:.5em;
            }
            #BundleDateRangeWrap, #BundlePartySizeWrap, #BundleSearchFilterWrap, #BundleItemsContainer .bundle-event-item-times, #BundleItemsContainer .bundle-event-item-prices, #BundleTotalWrap
            {
                width: 100%;
                float:none;
            }
            
            #BundleItemsContainer .bundle-event-item-times .button-time
            {
                max-width:24%;
                margin-right:1%;
                margin-top:0px;
                font-size:14px;
                line-height:2.5em;
            }
            #BundleItemsContainer .pc-selected-indicator{
                float:none;
            }
            #BundleItemsContainer .event-header .event-header-date:before{
                content: '';
                display:block;
            }
            .pc-select-button{
                line-height:2em;
            }
            #BundlePricingWrap{
                padding:10px!important;
            }
            
            .uniform-price-code-control{
                min-width:50%;
                padding:10px 0;
            }
            #UniformGoButton{
                position:static;
                width:100%;
                margin-top:15px;
            }

        }
        @media (max-width: 768px)
        {
            .uniform-price-code-control{
                min-width:100%;
            }
            .bundle-event-item-times{
                width:40%;
            }
            #BundleItemsContainer .bundle-event-item-times
            {
                width: 40%;
            }
            #BundleItemsContainer .bundle-event-item-prices {
                padding-left: 40%;
            }
            #BundleTray{
                width:100%;
                left:0px;
                right:0px;
                padding:.5em;
                padding-bottom:1em;
            }
                #BundleTray #BundleTrayInfo, #BundleTray #BundleTrayContinue
                {
                    width:100%;
                    padding:.25em 0;
                }
            #Loading{
                font-size:1.2em;
                
            }
            #Loading .fa{font-size:1.5em;display:block;margin-bottom:.5em;}
            
        }
        @media (max-width: 600px)
        {

            #BundleItemsContainer .bundle-event-item-prices
            {
                padding-left: 60%;
                
            }
            #BundleItemsContainer .price-code-name-label, #BundleItemsContainer .price-category-header {
                text-align: left;
            }
            #BundleItemsContainer .date-header
            {
                font-size:1.4em;
            }
            #BundleItemsContainer .event-header
            {
                font-size:1.3em;
            }
            .single-day-bundle #BundleDateRangeWrap, #BundlePricingWrap, .single-day-bundle #BundlePricingWrap {
                width:100%;
                margin:5px 0;
            }
        }
        /*single date option styles*/
        .single-day-bundle #toDateFilter, .single-day-bundle .date-filter-mid-label{
            display:none;
        }
        .single-day-bundle .dp-wrap{
                width:100%!important;
        }
    </style>
    <div tab-index="0" id="BundleInfoWrap">
        <h2 id="BundleName" class="heading-text">Super Ambassador Luau Package - Super Ambassador Luau Package</h2>
        <div id="BundleDescription"><span style="color: #993300; font-size: 18pt;">START HERE TO PLAN YOUR TRIP</span><br /><br /><strong><span style="color: #ff6600; font-size: 14pt;">Save 15% when you book at least 10 days in advance!&nbsp;</span></strong><br /><br /><span style="font-size: 14pt;"><span style="color: #993300;">Adult $242.95 --&gt;</span> <strong><span style="color: #ff6600;">$206.51 with advance booking</span></strong></span><br /><span style="font-size: 14pt;"><span style="color: #993300;">Child $194.36 --&gt;</span> <strong><span style="color: #ff6600;">$165.21 with advance booking</span></strong></span><br /><br /><br /><span style="color: #ff6600; font-size: 14pt;">Package Details</span><br /><span style="font-size: 12pt;">&bull; Private guided tour through 6 island villages</span><br /><span style="font-size: 12pt;">&bull; Your choice of Ali'i Luau Buffet &amp; Dinner Show or Prime Rib Buffet&nbsp;with <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; prime rib &amp; crab legs</span><br /><span style="font-size: 12pt;">&bull; Super Ambassador seating (front two rows) at &ldquo;Ha: Breath of Life&rdquo; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; evening show<br /></span><br /><span style="color: #ff6600; font-size: 14pt;">Additional Benefits</span><br /><span style="font-size: 12pt;">&bull; Transportation from Waikiki, if needed (additional charge)</span><br /><span style="font-size: 12pt;">&bull; Ivory kukui nut lei at arrival and flower lei greeting at luau</span><br /><span style="font-size: 12pt;">&bull; Reserved canoe ride</span><br /><span style="font-size: 12pt;">&bull; Reserved seating at all village presentations&nbsp;and more...<br /><br /><img src="https://ticketing.polynesia.com/UPLImage/SUPER-AMBASSADOR-LUAU-PACKAGE.jpg" alt="Image Description" width="400" height="267" /><br /></span></div>
    </div>
    <div id="BundleTotalWrap" style="display:none;">
        <div style="font-weight:bold;opacity:0.8;font-size:1.2em;"><span id="BundleTotalName"></span></div>
        <table width="100%">
            <tr>
                <td><span style="display:inline-block;"># of Items:</td>
                <td align="right"></span><span id="BundleTotalQty"></span></td>
            </tr>
            <tr>
                <td><span style="display:inline-block;">Subtotal:</td>
                <td align="right"></span>$<span id="BundleTotaPrice"></span></td>
            </tr>
        </table>
    </div>
    <div id="BundleFiltersWrap" class="single-day-bundle uniform-purchase-bundle">
        <div id="BundlePartySizeWrap" class="info-box clear bundle-filter">
            <label class="section-label" for="qty">How many guests in your party?</label>
            <div class="input-with-incremental-buttons">
                <a id="qty-reduce" class="button qty-reduce disabled">-</a><input id="qty-txt" name="qty" class="qty-small-text showare-text" type="number" maxlegth="2" placeholder="Quantity" style="text-align:center"><a id="qty-add" class="button qty-add">+</a>
            </div>
        </div><!-- END #BundlePartySizeWrap -->
        <div id="BundleSearchFilterWrap" class="info-box clear bundle-filter">
            <label class="section-label" for="SearchFilterInput">Filter Results</label>
            <input name="SearchFilterInput" id="SearchFilterInput" class="showare-text" value="" placeholder="Search" />
        </div><!-- END #BundlePartySizeWrap -->

        <div id="BundleDateRangeWrap" class="info-box clear bundle-filter" style="position:relative;">
            <label class="section-label" for="fromDateFilter"><span class="step-enum" aria-hidden="true"><i class="fa fa-check"></i><span class="step-number">2</span></span>When are you visiting?</label>
            <div class="dp-wrap" style="float:left;width:45%;position:relative;">
                <input type="text" id="fromDateFilter" name="fromDateFilter" class="showare-text" placeholder="From mm/dd/yyyy" readonly/>
                <div id="fromCalendar" class="sw-datepicker is-modal" aria-hidden="true">
                    <link rel="stylesheet" href="/include/font-awesome/css/font-awesome.min.css" />
<div tabindex="0" class="calendar-object">
    <style type="text/css" scoped>
        .sw-datepicker
        {
            font-size:inherit;/*Calendar size is determined by parent's font size.*/
        }
        .sw-datepicker[aria-hidden=true]
        {
            display:none;
        }

        .sw-datepicker.is-modal{
            margin: 10px;
            padding: 2px;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            position: absolute;
            top:30px;
            left:0px;
            z-index:99;
            background-color: #fff;
            border: 1px solid #ccc;
            box-shadow: 0px 0px 6px RGBA(0,0,0,0.4);
        }
            .sw-datepicker.is-modal.right-side
            {
                left:auto;
                right:0px;
            }
        .sw-datepicker .month-wrap
        {
            background-color: #337ab7;
            border: 1px solid #2e6da4;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            text-align:center;
        }
        .sw-datepicker .bn_next, div.bn_prev{
            margin: 2px;
            border:1px solid transparent;
            line-height:1.3em;
            color:#fff;
            padding:0 .25em;
            font-weight:bold;
            cursor:pointer;
        }
        .sw-datepicker .bn_prev
        {
            float: left;
        }

        .sw-datepicker .bn_next
        {
            float: right;
        }

            .sw-datepicker .bn_prev:hover,
            .sw-datepicker .bn_prev:focus,
            .sw-datepicker .bn_next:hover,
            .sw-datepicker .bn_next:focus
            {
                margin: 2px;
                background-color: #4fbae0;
                border: 1px solid #00a4df;
                -webkit-border-radius: 4px;
                -moz-border-radius: 4px;
                border-radius: 4px;
            }

        .sw-datepicker .bn_img
        {
            margin: 0;
            padding: 2px;
        }

        .sw-datepicker .month
        {
            display:inline-block;
            line-height:1.5em;
            font-weight: bold;
            font-size: 1.2em;
            color:#fff;
        }

        .sw-datepicker .cal
        {
            font-size: 1.2em;
            text-align: center;
        }


        .sw-datepicker .offscreen
        {
            position: absolute;
            left: -200em;
            top: -100em;
        }

        td span.calendar-day{
            display:inline-block;
            height:1.5em;
            width:1.5em;
            line-height:1.5em;
            border-radius:3px;
            margin:.1em;
    
        }
        td.highlight-day span.calendar-day{
            border:1px solid #337ab7;
            background:#fcfcfc;
            color:#337ab7;
            cursor:pointer;
        }
        .sw-datepicker abbr{
            text-decoration:none;
            opacity:.4;
            display:inline-block;
            margin:.3em 0;
        }
        td.today{
            background:#eee;
        }
        td.focus{
            background:#8ecae0;
        }
    </style>
    <div class="month-wrap">
        <div class="bn_prev" role="button" aria-labelledby="bn_prev-label" tabindex="0" title="Previous Month"><i class="fa fa-backward" aria-hidden="true"></i></div>
        <div tabindex="0" class="month" role="heading" aria-live="assertive" aria-atomic="true">February 2011</div>
        <div class="bn_next" role="button" aria-labelledby="bn_next-label" tabindex="0" title="Next Month"><i class="fa fa-forward" aria-hidden="true"></i></div>
    </div>
    <table title="Search Date - Select a date to search" class="cal" role="grid" aria-activedescendant="errMsg" aria-labelledby="month" tabindex="0" style="margin: 0px auto;outline:none!important;">
        <thead>
        <tr class="weekdays">
            <th class="Sunday"><abbr title="Sunday">Su</abbr></th>
            <th class="Monday"><abbr title="Monday">Mo</abbr></th>
            <th class="Tuesday"><abbr title="Tuesday">Tu</abbr></th>
            <th class="Wednesday"><abbr title="Wednesday">We</abbr></th>
            <th class="Thursday"><abbr title="Thursday">Th</abbr></th>
            <th class="Friday"><abbr title="Friday">Fr</abbr></th>
            <th class="Saturday"><abbr title="Saturday">Sa</abbr></th>
        </tr>
        </thead>
        <tbody>
            <tr><td class="errMsg" colspan="7">Javascript must be enabled</td></tr>
        </tbody>
    </table>
    <div class="bn_prev-label offscreen">Go to previous month</div>
    <div class="bn_next-label offscreen">Go to next month</div>
</div>

                </div>
            </div>
            <span class="date-filter-mid-label" style="line-height:34px;position:absolute;left:50%;width:20px;height:34px;margin-left:-10px;text-align:center;pointer-events:none;">to</span>
            <div class="dp-wrap" style="float:right;width:45%;position:relative;">
                <input type="text" id="toDateFilter" class="showare-text" placeholder="To mm/dd/yyyy" readonly/>
                <div id="toCalendar" class="sw-datepicker is-modal" aria-hidden="true">
                    <link rel="stylesheet" href="/include/font-awesome/css/font-awesome.min.css" />
<div tabindex="0" class="calendar-object">
    <style type="text/css" scoped>
        .sw-datepicker
        {
            font-size:inherit;/*Calendar size is determined by parent's font size.*/
        }
        .sw-datepicker[aria-hidden=true]
        {
            display:none;
        }

        .sw-datepicker.is-modal{
            margin: 10px;
            padding: 2px;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            position: absolute;
            top:30px;
            left:0px;
            z-index:99;
            background-color: #fff;
            border: 1px solid #ccc;
            box-shadow: 0px 0px 6px RGBA(0,0,0,0.4);
        }
            .sw-datepicker.is-modal.right-side
            {
                left:auto;
                right:0px;
            }
        .sw-datepicker .month-wrap
        {
            background-color: #337ab7;
            border: 1px solid #2e6da4;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            text-align:center;
        }
        .sw-datepicker .bn_next, div.bn_prev{
            margin: 2px;
            border:1px solid transparent;
            line-height:1.3em;
            color:#fff;
            padding:0 .25em;
            font-weight:bold;
            cursor:pointer;
        }
        .sw-datepicker .bn_prev
        {
            float: left;
        }

        .sw-datepicker .bn_next
        {
            float: right;
        }

            .sw-datepicker .bn_prev:hover,
            .sw-datepicker .bn_prev:focus,
            .sw-datepicker .bn_next:hover,
            .sw-datepicker .bn_next:focus
            {
                margin: 2px;
                background-color: #4fbae0;
                border: 1px solid #00a4df;
                -webkit-border-radius: 4px;
                -moz-border-radius: 4px;
                border-radius: 4px;
            }

        .sw-datepicker .bn_img
        {
            margin: 0;
            padding: 2px;
        }

        .sw-datepicker .month
        {
            display:inline-block;
            line-height:1.5em;
            font-weight: bold;
            font-size: 1.2em;
            color:#fff;
        }

        .sw-datepicker .cal
        {
            font-size: 1.2em;
            text-align: center;
        }


        .sw-datepicker .offscreen
        {
            position: absolute;
            left: -200em;
            top: -100em;
        }

        td span.calendar-day{
            display:inline-block;
            height:1.5em;
            width:1.5em;
            line-height:1.5em;
            border-radius:3px;
            margin:.1em;
    
        }
        td.highlight-day span.calendar-day{
            border:1px solid #337ab7;
            background:#fcfcfc;
            color:#337ab7;
            cursor:pointer;
        }
        .sw-datepicker abbr{
            text-decoration:none;
            opacity:.4;
            display:inline-block;
            margin:.3em 0;
        }
        td.today{
            background:#eee;
        }
        td.focus{
            background:#8ecae0;
        }
    </style>
    <div class="month-wrap">
        <div class="bn_prev" role="button" aria-labelledby="bn_prev-label" tabindex="0" title="Previous Month"><i class="fa fa-backward" aria-hidden="true"></i></div>
        <div tabindex="0" class="month" role="heading" aria-live="assertive" aria-atomic="true">February 2011</div>
        <div class="bn_next" role="button" aria-labelledby="bn_next-label" tabindex="0" title="Next Month"><i class="fa fa-forward" aria-hidden="true"></i></div>
    </div>
    <table title="Search Date - Select a date to search" class="cal" role="grid" aria-activedescendant="errMsg" aria-labelledby="month" tabindex="0" style="margin: 0px auto;outline:none!important;">
        <thead>
        <tr class="weekdays">
            <th class="Sunday"><abbr title="Sunday">Su</abbr></th>
            <th class="Monday"><abbr title="Monday">Mo</abbr></th>
            <th class="Tuesday"><abbr title="Tuesday">Tu</abbr></th>
            <th class="Wednesday"><abbr title="Wednesday">We</abbr></th>
            <th class="Thursday"><abbr title="Thursday">Th</abbr></th>
            <th class="Friday"><abbr title="Friday">Fr</abbr></th>
            <th class="Saturday"><abbr title="Saturday">Sa</abbr></th>
        </tr>
        </thead>
        <tbody>
            <tr><td class="errMsg" colspan="7">Javascript must be enabled</td></tr>
        </tbody>
    </table>
    <div class="bn_prev-label offscreen">Go to previous month</div>
    <div class="bn_next-label offscreen">Go to next month</div>
</div>

                </div>
            </div>
        </div><!-- END #BundleDateRangeWrap -->
        
        <div id="BundlePricingWrap" class="info-box clear">
            <label class="section-label" for="qty">Please Select Pricing</label>
            <div id="UniformPriceCodesContainer">
                <div class="input-with-incremental-buttons uniform-price-code-control"><a id="qty-SUP_A-reduce" class="button qty-reduce qty-unified disabled" data-my-linked-input="qty-unified-SUP_A-txt">-</a><input id="qty-unified-SUP_A-txt" data-pricing-code="SUP_A" name="qty-SUP_A" class="qty-small-text unified-qty-txt showare-text" type="number" maxlegth="2" placeholder="Adult" style="text-align:center"><a id="qty-SUP_A-add" class="button qty-add qty-unified" data-my-linked-input="qty-unified-SUP_A-txt">+</a></div><div class="input-with-incremental-buttons uniform-price-code-control"><a id="qty-SUP_C-reduce" class="button qty-reduce qty-unified disabled" data-my-linked-input="qty-unified-SUP_C-txt">-</a><input id="qty-unified-SUP_C-txt" data-pricing-code="SUP_C" name="qty-SUP_C" class="qty-small-text unified-qty-txt showare-text" type="number" maxlegth="2" placeholder="Child" style="text-align:center"><a id="qty-SUP_C-add" class="button qty-add qty-unified" data-my-linked-input="qty-unified-SUP_C-txt">+</a></div>
            </div>
            
            <button class="button showare-button-primary" id="UniformGoButton" onclick="SetUnifiedQty(true)">GO!</button>
        </div><!-- END #BundlePricingWrap -->
        
    </div><!-- END #BundleFiltersWrap -->
    <script type="text/javascript">
        uniformAddons = 1;
        //$("#qty-1-txt");
        $("#qty-txt").change(function () {
            validateFilters();
        });
        $("#qty-reduce, .qty-reduce").click(function () {
            var myInput = $("#qty-txt");
            if($(this).data("my-linked-input")){
                myInput = $("#"+$(this).data("my-linked-input"));
            }
            var myVal = parseInt(myInput.val()) || 0;
            myVal--;
            if (myVal <= 0) {
                myInput.val("");
            } else {
                myInput.val(myVal);
            }
            if($(this).hasClass("qty-unified")){
                SetUnifiedQty(false);
            }else{
                validateFilters();
            }
        });
        $("#qty-add, .qty-add").click(function () {
            var myInput = $("#qty-txt");
            if($(this).data("my-linked-input")){
                myInput = $("#"+$(this).data("my-linked-input"));
            }
            var myVal = parseInt(myInput.val()) || 0;
            myVal++;
            if(myVal > 0){
                $(this).siblings(".qty-reduce").removeClass("disabled");
            }
            myInput.val(myVal);
            if($(this).hasClass("qty-unified")){
                SetUnifiedQty(false);
            }else{
                validateFilters();
            }

            
        });
        $("#SearchFilterInput").on("keyup change cleared",function(){
            myState.searchString = $(this).val();
            validateFilters();
        });
        fromDP = buildDatepicker({"calendarID":"fromCalendar","linkedInputID":"fromDateFilter","isModal":true, "type": "bundleperformancedates", "bundleID": 9});
        toDP = buildDatepicker({"calendarID":"toCalendar","linkedInputID":"toDateFilter","isModal":true, "type": "bundleperformancedates", "bundleID": 9});
        $("#fromDateFilter").on("mousedown touchstart",function(){
            fromDP.showDlg();
        });
        $("#toDateFilter").on("mousedown touchstart",function(){
            toDP.showDlg();
        });
        function updateDatepickerDefaults(d){
            try{
                toDP.year = d.getFullYear();
                toDP.month = d.getMonth() - 1;
                toDP.showNextMonth();
                fromDP.year = d.getFullYear();
                fromDP.month = d.getMonth() - 1;
                fromDP.showNextMonth();
            }catch(e){
                console.log("could not update calendars:");
                console.log(e);
            }
        }
        var dateFilterOptions = { weekday: 'short', month: 'short', day: 'numeric' };
        $("#fromDateFilter").change(function () {
            try {
                myState.fromDate = new Date($("#fromDateFilter").val());
                updateDatepickerDefaults(myState.fromDate);
                $(this).val(myState.fromDate.toLocaleDateString('en-US', dateFilterOptions));
                if(bundleData.singleDayBundle){
                    myState.toDate = myState.fromDate;
                }
            } catch (e) {
                $("#fromDateFilter").val("");
                $("#toDateFilter").val("");
                myState.fromDate = -1;
                myState.toDate = -1;
            }
            if (myState.fromDate > myState.toDate && $("#toDateFilter").val() != "") {
                $("#toDateFilter").val($("#fromDateFilter").val());
                myState.toDate = myState.fromDate;
            }
            validateFilters();
        });
        $("#toDateFilter").change(function () {
            try {
                myState.toDate = new Date($("#toDateFilter").val());
                updateDatepickerDefaults(myState.toDate);
                $(this).val(myState.toDate.toLocaleDateString('en-US', dateFilterOptions));
            } catch (e) {
                clearFilters();
            }
            //check if "to date" is behind from date, if so move from date back
            if (myState.fromDate > myState.toDate && $("#fromDateFilter").val() != "") {
                $("#fromDateFilter").val($("#toDateFilter").val());
                myState.fromDate =  myState.toDate;
            }
            validateFilters();
        });
        var unifiedQty = {}
        function SetUnifiedQty(doValidation){
            if($("#fromDateFilter").val() === '' && myState.viewMode != 'event'){
                notifyUser("Please select a date to continue.");
                return;
            }

            var totalQty = 0;
            $(".unified-qty-txt").each(function(i, pcTxt){
                if($(this).val() != ''){
                    var thisPC = {};
                    unifiedQty[$(pcTxt).data("pricing-code")] = parseInt($(pcTxt).val());
                    totalQty += parseInt($(pcTxt).val());
                }
            })
            $("#qty-txt").val(totalQty);
            unifiedQty.totalQty = totalQty;
            if(totalQty === 0){
                notifyUser("Please select pricing to continue.");
                return;
            }
            if(doValidation)
                validateFilters();
        }
        function selectUnifiedCategory(button, performanceID, categoryID){
            if($(button).hasClass("selected")){
                $(button).removeClass("selected");
                $(".price-category-performance-" + performanceID + " .pc-select-text").each(function(i, pcSelectText){
                    if($(pcSelectText).data("category") == categoryID){
                        $(pcSelectText).val('');
                    }
                });
                updateOrderState();
                return;
            }
            $(button).addClass("selected");
            $(".price-category-performance-" + performanceID + " .pc-select-text").each(function(i, pcSelectText){
                if($(pcSelectText).data("category") == categoryID){
                   $(pcSelectText).val(unifiedQty[$(pcSelectText).data("pricecode")]);
                }
            });
            updateOrderState();
            /* THIS MAY NOT BE IDEAL - commented out for now
            $(".bundle-event-item").each(function(i, o){
                if($(o).data("performanceid") === performanceID)
                    closeEventPerformance(o)
            })
            */
        }
        function closeEventPerformance(closeObj){
            $(closeObj).removeClass("active").find(".bundle-event-item-contents").slideUp(400);;
        }
        function validateDates() {
            if (myState.fromDate == "Invalid Date") {
                $("#fromDateFilter").val("");
                myState.fromDate = -1;
            } 
            if (myState.toDate == "Invalid Date") {
                $("#toDateFilter").val("");
                myState.toDate = -1;
            }

            if(myState.toDate != -1 && myState.fromDate != -1){
                $("#BundleDateRangeWrap").addClass("is-validated");
            }else{
                $("#BundleDateRangeWrap").removeClass("is-validated");
                bundleData.reset();
            }
            return myState.toDate != -1 && myState.fromDate != -1
        }
        function validateQuantity() {
            var minRequiredQty = 1; //minimum quantity requirements
            var maxAllowedQty = 99; //minimum quantity requirements
            if(!Number.isInteger(parseInt($("#qty-txt").val()))){
                $("#qty-txt").val('');
                return false;
            }
            if(parseInt($("#qty-txt").val()) > maxAllowedQty){
                $("#qty-txt").val(maxAllowedQty);
            }
            if (parseInt($("#qty-txt").val()) >= minRequiredQty && $("#qty-txt").val() != "") {
                $("#qty-reduce").removeClass("disabled");
                $("#BundlePartySizeWrap").addClass("is-validated");
                orderData.partySize = parseInt($("#qty-txt").val());
                return true;
            } else {
                $("#qty-reduce").addClass("disabled");
                $("#BundlePartySizeWrap").removeClass("is-validated");
                orderData.partySize = 0;
                bundleData.reset();
                return false;
            }viewmode

        }
        function validateFilters() {
            if(myState.viewMode == "event" && 1 === 0){
                filterResults(); //for event views, we just filter based on what we have
                if(myState.hasBundleInfo)
                    return;
            }
            validateDates();validateQuantity();
            if(validateQuantity() && validateDates()){
                //filters are good, get the data!
                fetchBundleData(bundleData.bundleID, bundleData.pricingTierID, myState.fromDate, myState.toDate);
                showLoad("Getting Package contents");
            }else{
                $("#BundleItemsContainer").html('');
                $("#BundleInstructions").hide();
                handleLoaded();
            }
        }
        function filterResults(){
            if($("#SearchFilterInput").val() == "" && $("#fromDateFilter").val() == "" && $("#toDateFilter").val() == ""){
                $(".event-performances-display-button").show();
            }else{
                $(".event-performances-display-button").hide().addClass("on");
            }
            $(".bundle-event-item").removeClass("filtered").hide(); //hide all items, show relevant ones
            $(".bundle-event-item.selected").show();
            $(".bundle-event-item").each(function(){
                var thisDate = new Date($(this).data("event-date"));
                var thisEndDate = new Date($(this).data("event-end-date"));
                if(withinDates(thisDate, thisEndDate) && $(this).find(".event-header:contains('" + myState.searchString + "')").length){
                    $(this).show().addClass("filtered");//this specific item matches a search
                }
                if(withinDates(thisDate, thisEndDate) && $(this).parent().find(".event-container-header:contains('" + myState.searchString + "')").length){
                    $(this).show().addClass("filtered");//this parent item (the event) matches the search
                }
            });
            $(".bundle-event-container").removeClass("no-results");
            $(".bundle-event-container").each(function(){
                if($(this).find(".filtered").length === 0 && $(this).find(".selected").length === 0){
                    //all of these were filtered out
                    $(this).addClass("no-results");
                }
            });
        }
        function withinDates(startDate, endDate){
            var validDates = false;
            try{
                if(startDate == "Invalid Date" || endDate == "Invalid Date")
                    return true;//the dates passed in were not valid, show the object

                //this is one of those things that's going to emberass me some day (maybe tomorrow)
                validDates = (startDate >= myState.fromDate && startDate <= myState.toDate) || (endDate >= myState.fromDate && endDate <= myState.toDate) || (myState.toDate >= startDate && myState.fromDate <= endDate);
                return validDates;
            }catch(e){
                console.log(e);
                return true;//default to showing the object
            }
        }
        function clearFilters(){
            $("#fromDateFilter").val("");
            $("#toDateFilter").val("");
            $("#BundleSearchFilterWrap").val("");
                
        }
        function showLoad(text){
            //disable all controls
            $("#BundleFiltersWrap").addClass("disabled");
            $("#BundleItemsWrap").hide();
            $("#LoadWrap").show();
            $("#LoadingText").html(text);
            $("#AddOnContinueButton").hide();
        }
        function handleLoaded(){
            $("#BundleItemsWrap").show();
            $("#BundleFiltersWrap").removeClass("disabled");
            $("#LoadWrap").hide();
            $("#AddOnContinueButton").show();
            

        }
       
        // IE's little clear button refuses to follow any rules
        $("input").bind("mouseup", function(e){
            var $input = $(this),
                oldValue = $input.val();

            if (oldValue == "") return;

            // When this event is fired after clicking on the clear button in IE
            // the value is not cleared yet. We have to wait for it.
            setTimeout(function(){
                var newValue = $input.val();

                if (newValue == ""){
                    // Gotcha
                    $input.trigger("cleared");
                }
            }, 1);
        });
    </script>

    <div class="clear"></div>
    <div id="LoadWrap" style="text-align:center;display:none;">
        <div id="Loading" style=""><i class="fa fa-spinner fa-spin"></i><span id="LoadingText"></span>...</div>
    </div>
    <div id="BundleItemsWrap" style="padding:10px;" class="clear">
        <div id="BundleInstructions" class="section-label">Please select tickets for <span id="BundleLimitsRangeText"></span> different <span id="BundlePurchaseTypeText"></span>. <span id="BundleMinimumPurchasesText"></span></div>
        <div id="BundleItemsContainer">

        </div>
    </div><!-- END #BundleItemsWrap -->
    <div id="BundleUpgradeTray">
        <div style="padding-bottom:.5em;">
            <i class="fa fa-exclamation-circle" style="float:left;height:3em;font-size:2em;margin-right:.5em;"></i><span id="UpgradeMessage">An upgrade is available based on the selections you've currently made. Consider upgrading now.upgradeulr</span>
        </div>  
        <button id="BundleUpgradeButton" class="button" style="float:right;margin:0;" onclick="upgradeBundle();">Upgrade Now!</button>
    </div>
    <div id="BundleTray">
        <div id="BundleTrayInfo">
            THIS IS THE BUNDLE STATUS INFO BOX #BundleTrayInfo
        </div>
        <div id="BundleTrayContinue">
            <button id="BundleContinueButton" class="button sw-button-primary disabled">Continue</button>
        </div>
    </div><!-- END #BundleTray -->
</div> <!-- END #BundleSelectWrap -->
<script type="text/javascript">
    //-------------------------------------------------------app control--------------------------------------------------
    var myState = {
        "hasBundleInfo": false,
        "ticketQty":0,
        "fromDate": -1,
        "toDate": -1,
        "searchString": "",
        "selectedEvents": [],
        "selectedPerformances": [],
        "purchaseMode": "bundle",
        "viewMode": "date"
    }
    var bundleData = {
        "bundleID": 9,
        "pricingTierID": 17,
        "name": "",
        "description": "",
        "pricingTier": {},
        "events": [],
        "performances": [],
        "dates": [],
        "purchaseType": "",
        "addOns": [],
        "addOnDescription": "",
        "singleDayBundle": 1
    }
    orderData = {
        "partySize": 0,
        "bundleID": -1,
        "partySize": 0,
        "bundleTotal": 0,
        "bundleQty": 0,
        "bundlePerformances": [],
        "addOnPerformances": []
    }
    if(myState.viewMode == "event"){
        $("#BundlePartySizeWrap").hide();
        myState.fromDate = new Date();
        myState.toDate = new Date("12/31/2099");
        if(1 === 0)
            fetchBundleData(bundleData.bundleID, bundleData.pricingTierID, myState.fromDate, myState.toDate);
        if(1 === 1)
            $("#BundleSearchFilterWrap").hide();
    }else{
        $("#BundleSearchFilterWrap").hide();
    }
    orderData.getBundlePurchase = function () {
        //clear old bundle purchase
        this.bundleID = bundleData.bundleID;
        this.bundlePerformances = gatherTicketData();
    }
    orderData.getAddOnPurchase = function () {
        this.addOnPerformances = gatherTicketData();
    }
    //support functions for order building
    function addPerformanceIDtoOrder(currentOrder, newID){
        //loops through the current order array and finds the index of the newID, or adds it
        //  returns index
        var perfIndex = -1;
        currentOrder.forEach(function(o, i){
            if(o.id == newID){
                perfIndex = i;
            }
        });
        if(perfIndex != -1)
            return perfIndex;

        //if we made it here, there's no matching performance -- add one:
        currentOrder.push( {"id": newID, "tickets": []} );
        return currentOrder.length -1;
    }
    function gatherTicketData(){
        //returns an array of performance objects with ticket selections
        var ticketData = [];
        $(".bundle-event-item.selected input.pc-select-text").each(function(){
            if($(this).val() > 0){
                var newTicket = { "seatCategoryID": parseInt($(this).data("category")), "priceCode": $(this).data("pricecode"), "quantity": parseInt($(this).val()) };
                var pindex = addPerformanceIDtoOrder(ticketData, parseInt($(this).data("performance")));
                ticketData[pindex].tickets.push(newTicket);
            }
        });
        if(myState.purchaseMode != "addon"){
            //use the bundle ticket data to gather bundle purchases
            $.ajax({
                method: "GET",
                url: "/bundles/BundleRequests.asp",
                data: {"action": "getprice", "data": JSON.stringify(ticketData)}
            }).done(function (data) {
                //handle succes/failure here
                try{
                    data = JSON.parse(data);
                    orderData.bundleTotal = data.BundlePrice;
                    orderData.bundleQty = myState.ticketQty;
                    $("#BundleTotalWrap").show();
                    $("#BundleTotalQty").html(orderData.bundleQty);
                    $("#BundleTotaPrice").html(orderData.bundleTotal.toFixed(2));
                    $("#BundleTotalName").html(bundleData.name);
                }catch(e){
                    console.log(e);
                }
            }).fail(function(){
                $("#BundleMainWrap").addClass("error-message").html('Something went wrong! Most likely an event has sold out while you were making your selections. Please <a onclick="window.location.reload()" style="cursor:pointer;text-decoration:underline;">reload</a> this page and try again.');
            });
        }
        return ticketData;
    }
    bundleData.reset = function () {
        //we currently don't need to reset or redraw the bundle name or description - they should not change
        this.events = [];
        this.performances = [];
        this.dates = [];
        this.purchaseType = "";
        this.upgradeData = "";
        bundleData.ticketsAutoAdded = false;
        $(".bundle-date:not(.has-tickets)").remove();
        $(".bundle-event-item").removeClass("active");
        $(".bundle-event-item-contents").hide();
        $("#BundleItemsWrap").hide();
        $("#UserNotice").remove();
    }
    bundleData.validate = function () {
        //we've grabbed data and extracted it, any checks we need to make on the data can be done here.
        if(bundleData.events.length === 0){
            //no events, this won't work!
            notifyUser("There are no events available for the dates selected. Please broaden your search.");
            return false;
        }
        //verify that all required events were returned
        var eventArray = [], checkFail = false;
        this.events.forEach(function(o){eventArray.push(o.id)});
        this.requiredEvents.forEach(function(r){
            if(r.EventID > 0 && eventArray.indexOf(r.EventID) === -1){
                notifyUser("Not all required events are available on the dates you have selected. Please broaden your search, or select new dates.");
                checkFail = true; //javascript was built by an evil imp who haunts me and chases me in my dreams.
            }
        });
        if(checkFail){
            return false;
        }
        return true;
    }
    function notifyUser(msg){
        $("#UserNotice").remove();
        handleLoaded();
        $("#BundleMainWrap").append('<div id="UserNotice" class="error-message">' + msg + '</div>');
    }
    bundleData.validateOrderRequirements = function(){
        var result = {"message":"","success":true,"eventMinimumsMet":true,"eventMinimumsMessage":""};
        $("#BundleTrayContinue .button").removeClass("disabled");
        var typeCount, typeNoun;
        var purchaseType = this.pricingTier.purchaseType.purchaseType.toLowerCase();
        var typeMin = this.pricingTier.purchaseType.minPurchases;
        var typeMax = this.pricingTier.purchaseType.maxPurchases;
        $(".required-indicator").remove();
        if(purchaseType == "event"){
            typeCount = myState.selectedEvents.length;
            typeNoun = "event";
        }else{
            typeCount = myState.selectedPerformances.length;
            typeNoun = "performance";
        }
        result.message = "You have selected " + myState.ticketQty + " ticket" + addS(myState.ticketQty) + " from " + typeCount + " " + typeNoun + addS(typeCount) + ".";
        var hasRequirementsNotMet = false;
        this.events.forEach(function(o){
            if(o.minimumPurchaseDays > 0 && purchaseType == "event"){
                //this event must be purchased on multiple days
                var purchaseDays = [];
                $(".bundle-date").each(function(dateIndex){
                    if($(this).children(".bundle-event-item-" + o.eventID + ".selected").length)
                        purchaseDays.push($(this).data("date"));
                });
                if(myState.viewMode != "date"){
                    $(".bundle-event-item-" + o.eventID + ".selected").each(function(){
                        if(purchaseDays.indexOf($(this).data("event-date")) == -1)
                            purchaseDays.push($(this).data("event-date"));
                    });
                }
                if(o.minimumPurchaseDays > purchaseDays.length){
                    result.success = false;
                    if(o.minimumPurchaseDays - purchaseDays.length == 1){
                        $(".bundle-event-item-" + o.eventID + ":not(.selected) .event-header").append('<span class="required-indicator">required</span>');
                    }else{
                        $(".bundle-event-item-" + o.eventID + ":not(.selected) .event-header").append('<span class="required-indicator">' + String(o.minimumPurchaseDays - purchaseDays.length) + ' required</span>');
                    }
                    result.eventMinimumsMet = false;
                    if(hasRequirementsNotMet){
                        result.eventMinimumsMessage = result.eventMinimumsMessage.replace(', and the', ', the');
                        result.eventMinimumsMessage += ", and the " + o.name + " event on at least " + o.minimumPurchaseDays + " day" + addS(o.minimumPurchaseDays);
                    }else{
                        result.eventMinimumsMessage += " You must still select the " + o.name + " event on at least " + o.minimumPurchaseDays + " day" + addS(o.minimumPurchaseDays);
                    }
                    hasRequirementsNotMet = true;
                }
            }
            
        });
        if(result.eventMinimumsMessage != "")
            result.eventMinimumsMessage += " to continue.";
        if(typeCount >= typeMin && (typeCount <= typeMax || typeMax == 0)){
            //inside limits
            if((typeMax == typeCount || typeMax == 0) && !result.eventMinimumsMet){
                result.message += result.eventMinimumsMessage;;
            }
            if(typeMax > typeCount && result.eventMinimumsMet){
                result.message += " You may still select " + String(typeMax - typeCount) + " more " + typeNoun + addS(typeMax - typeCount) + ", or proceed to checkout at this time.";
            }
            if(typeMax > typeCount && !result.eventMinimumsMet){
                result.message += " You may still select " + String(typeMax - typeCount) + " more " + typeNoun + addS(typeMax - typeCount) + "." + result.eventMinimumsMessage;
            }
        }
        if(typeCount < typeMin){
            result.message = "You have selected " + myState.ticketQty + " ticket" + addS(myState.ticketQty) + " from " + typeCount + " " + typeNoun + addS(typeCount) + ". You'll need to select tickets from " + String(typeMin - typeCount) + " more " + typeNoun + addS(typeMin - typeCount) + " to continue." + result.eventMinimumsMessage;
            result.success = false;
        }
        if(typeCount > typeMax && typeMax != 0){
            result.message = "You have selected " + typeCount + " " + typeNoun + "s, your order only allows a maximum of " + typeMax + " " + typeNoun + "s. Please remove tickets to continue." + result.eventMinimumsMessage;
            result.success = false;
        }
        $("#BundleTrayInfo").html(result.message);
        if(result.success && result.eventMinimumsMet && this.upgradeData.hasUpgrade){
            var topURL = String(window.top.location).toLowerCase();
            if(topURL.indexOf("callcenter") == -1)
                showUpgrade();//we should probably only SHOW upgrade options, even if people back out of some items, popping this in and out is not ideal, and we always want to let them upgrade
        }
        if(!result.success || !result.eventMinimumsMet)
            $("#BundleTrayContinue .button").addClass("disabled");
        return result.success;
    }
    bundleData.extractData = function () {
        //write initial bundle data, if it hasn't been written yet
        if(!myState.hasBundleInfo){
            if(this.pricingTier.purchaseType.minPurchases == 0 && this.pricingTier.purchaseType.maxPurchases == 0){
                $("#BundleInstructions").html("Please select at least one item.")
            }
            if(this.pricingTier.purchaseType.maxPurchases != this.pricingTier.purchaseType.minPurchases){
                if(this.pricingTier.purchaseType.maxPurchases > 0){
                    $("#BundleLimitsRangeText").html(this.pricingTier.purchaseType.minPurchases + " to " + this.pricingTier.purchaseType.maxPurchases);
                }else{
                    $("#BundleInstructions").html("Please select tickets from at least " + this.pricingTier.purchaseType.minPurchases + " " + this.pricingTier.purchaseType.purchaseType.toLowerCase() + addS(this.pricingTier.purchaseType.minPurchases) + ".");
                }
            }else{
                $("#BundleLimitsRangeText").html(String(this.pricingTier.purchaseType.minPurchases));
            }
            $("#BundlePurchaseTypeText").html(this.pricingTier.purchaseType.purchaseType.toLowerCase() + addS(this.pricingTier.purchaseType.maxPurchases));
            this.UniformPurchase = 1;
            myState.hasBundleInfo = true;
        }
        if (this.events.length == 0) return; //we had no event data
        this.performances = [];this.dates = [];
        var me = this;
        //push all performances into me
        this.events.forEach(function (o) {
            o.eventID = o.id;
            o.performances.forEach(function (p) {
                p.eventID = o.id;
                if(!p.description || p.description == "")
                    p.description = o.description;
                me.performances.push(p);
            });
        });
        //get a list of dates from the performances
        this.performances.forEach(function (o) {
            var perfLength = Math.abs(new Date(o.performanceEnd).getTime() - new Date(o.performanceStart).getTime()) / (1000 * 3600 * 24); //get # of days in the performance
            if(perfLength < 1){
                o.startDate = getFormattedDate(o.performanceStart);
            }else{
                //add multi-date item
                o.startDate = getFormattedDate(o.performanceStart) + " - " + getFormattedDate(o.performanceEnd);
            }
            if(me.dates.indexOf(o.startDate) == -1)
                    me.dates.push(o.startDate);
        });
        //sort the dates
        this.dates.sort(function (a, b) {
            return new Date(a) - new Date(b);
        });
    }
    function fetchBundleData(bundleID, pricingTierID, fromDate, toDate) {
        showLoad("Getting Package contents");
        function formatDate(myDate) {
            if (Object.prototype.toString.call(myDate) != "[object Date]") return;
            return (myDate.getMonth() + 1) + "-" + myDate.getDate() + "-" + myDate.getFullYear();
        }
        fromDate = formatDate(fromDate);
        toDate = formatDate(toDate);
        var requestData = {};
        requestData.BundleID = bundleID;
        requestData.PricingTierID = pricingTierID;
        requestData.fromDate = fromDate;
        requestData.toDate = toDate;
        requestData.bundleBasketID = '1LFQkTST0VUgMg1jk10MjM0MSyMDDIwANMyzE03MTN0OC5OTC4xEMAujA21LjT1NyQTUkhS_VlQUx_M__';

        $.ajax({
            url: "//qa-pcc.showare.net/bundles/request/BundleGetPerformances.asp",
            data: requestData
        }).done(function( response ) {
            try{
                var myData = JSON.parse(response);
                //we're getting new bundle data, clear the old data
                bundleData.reset();
                //we'll manually populate bundle data here so we can retain bundledata methods and properties
                bundleData.events = myData.events;
                bundleData.name = myData.name;
                bundleData.description = myData.description;
                bundleData.pricingTier = myData.pricingTier;
                bundleData.addOns = myData.addOns.events;
                bundleData.addOnDescription = myData.checkoutDescription;
                bundleData.requiredEvents = myData.requiredEvents;
                bundleData.extractData();
                if (bundleData.validate()) {
                    renderBundleData(); //we got it all back, and it appears to meet all requirements - show to user
                    
                }
            }catch(e){
                handleLoaded();
                notifyUser("There are no events available for the dates selected. Please broaden your search.");
                console.log(e);
                console.log("Data Corrupt: \n" + response);
            }
        });
    }
    function placeBundleOrder() {
        showLoad("Building your Package");
        //build up the order data
        var reqData = {};
        reqData.bundlePurchaseRequest = {};
        reqData.bundlePurchaseRequest.bundleID = bundleData.bundleID;
        reqData.bundlePurchaseRequest.pricingTierId = bundleData.pricingTierID;
        reqData.bundlePurchaseRequest.partySize = orderData.partySize;
        reqData.bundlePurchaseRequest.performances = orderData.bundlePerformances;
        reqData.addOnPurchaseRequest = {};
        reqData.addOnPurchaseRequest.bundleID = 0;
        reqData.addOnPurchaseRequest.pricingTierId = 0;
        reqData.addOnPurchaseRequest.partySize = orderData.partySize;
        reqData.addOnPurchaseRequest.performances = orderData.addOnPerformances;
        $.ajax({
            method: "POST",
            url: "/bundles/purchaserequests/BundleAddToBasket.asp",
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            data: {"isCallCenter": "False", "sessionKey": sessionKey, "data": JSON.stringify(reqData)}
        }).done(function (data) {
            //handle succes/failure here
            if(data.isSuccessful){
                //success, move the user on
                
                    window.location.href = 'BundleBasket.asp';
                
            }else{
                //something failed
                handleLoaded();
                console.log("Order Error:")
                console.log("request:");
                console.log(reqData);
                console.log("response:");
                console.log(data);
                $("#BundleMainWrap").addClass("error-message").html('Something went wrong! Most likely an event has sold out while you were making your selections. Please <a onclick="window.location.reload()" style="cursor:pointer;text-decoration:underline;">reload</a> this page and try again.');
            }
        }).fail(function(){
            console.log("Request Error")
            $("#BundleMainWrap").addClass("error-message").html('Something went wrong! Most likely an event has sold out while you were making your selections. Please <a onclick="window.location.reload()" style="cursor:pointer;text-decoration:underline;">reload</a> this page and try again.');
        });
    }
    var bundlePurchaseRequest = {
        "bundleID": 0,
        "partySize": 0,
        "performances": []
    }
    function updateOrderState(){
        var ticketsPresent = 0;
        myState.selectedEvents = [];
        myState.selectedPerformances = [];
        if(myState.purchaseMode != "addon")
            myState.ticketQty = 0;
        $(".bundle-event-item").removeClass("selected");
        $(".has-tickets").removeClass(".has-tickets");
        $(".pc-selected-indicator").remove();$(".pc-selected-break").remove();//remove all order state indicators
        $(".pc-select-text").each(function(){
            var myVal = parseInt($(this).val()) || 0;
            if(myVal > 0){
                var myEventID = $(this).data("event");
                var myPerformanceID = $(this).data("performance");
                var myContainer = $(this).closest(".bundle-event-item-" + myEventID);
                var myIndicator = document.createElement("div");
                if(myContainer.children(".pc-selected-break").length == 0);
                    myContainer.append('<br class="pc-selected-break"/>');
                myIndicator.setAttribute("class","pc-selected-indicator");
                myIndicator.innerHTML = myVal + " " + $(this).data("pcname");
                myContainer.addClass("selected").children(".event-header").append(myIndicator); //add an indicator to this event to show tickets are selected, for each type
                myContainer.parent().addClass("has-tickets");
                //pass event/performance info into state for validating later
                if(myState.selectedEvents.indexOf(myEventID) == -1){
                    myState.selectedEvents.push(myEventID);
                }
                if(myState.selectedPerformances.indexOf(myPerformanceID) == -1){
                    myState.selectedPerformances.push(myPerformanceID);
                }
                myState.ticketQty += myVal;
            }
            ticketsPresent += myVal;
        });
        if(bundleData.ticketsAutoAdded){
            bundleData.ticketsAutoAdded = false;
            $("#BundleContinueButton").click();
            return;
        }

        if(myState.purchaseMode == "addon")
            return; //addons do not require validation
        
        bundleData.validateOrderRequirements();
        
        showTray(ticketsPresent > 0);
    }

    //-------------------------------------------------------Upgrade Functions--------------------------------------------
    var upgradeURL = "";
    var selections = [];
    var selectionsLoaded = false;
    function fetchUpgradeInfo(bundleID){
        $.ajax({
            url: "//qa-pcc.showare.net/bundles/request/BundleGetUpgrade.asp",
            data: {"BundleID": bundleID}
        }).done(function( response ) {
            try{
                bundleData.upgradeData = JSON.parse(response);
                if(bundleData.upgradeData.upgradeBundle === 0 || bundleData.upgradeData.upgradeTier === 0)
                    bundleData.upgradeData.hasUpgrade = 0;//upgrade information missing
                if(bundleData.upgradeData.hasUpgrade === 1){
                    upgradeURL = ["/BundleSelect.asp?BundleID=",bundleData.upgradeData.upgradeBundle,"&PricingTierID=",bundleData.upgradeData.upgradeTier,"&upgrade=true"].join("");
                    if(bundleData.upgradeData.upgradeMessage != "")
                        $("#UpgradeMessage").html(bundleData.upgradeData.upgradeMessage)
                }
                
            }catch(e){
                console.log("Error fetching upgrade data:");
                console.log(e);
            }
        });
    }
    function showUpgrade(){
        
        $("#BundleUpgradeTray").addClass("show");
    }
    function hideUpgrade(){
        $("#BundleUpgradeTray").removeClass("show");
    }
    function upgradeBundle(){
        storeSelections();
        window.location.href = upgradeURL;
    }
    function getSelections(){
        try{
            var selections = JSON.parse(localStorage.getItem("bundleUpgrade"));
            //data-performance="4512" data-event="2649" data-category="1538" data-pricecode="BUNADLT"
            selections.forEach(function(o){
                var selectInputString = ['input[data-performance="',o.performance,'"][data-event="',o.event,'"][data-category="',o.category,'"]'].join(''); 
                var selectedInput = $(selectInputString + '[data-pricecode="'+ o.pricecode +'"]');// attempt selecting the same price code
                if(selectedInput.length === 0){
                    //no exacct match found, cycle through upgrade paths to search for a match
                    bundleData.upgradeData.upgradePaths.forEach(function(upgrPath){
                        if(upgrPath.PricingCode == o.pricecode && selectedInput.length === 0){
                            selectedInput = $(selectInputString + '[data-pricecode="'+ upgrPath.UpgradePricingCode +'"]');
                            if(selectedInput.length){
                                selectedInput.val(o.qty);
                            }
                                
                        }
                    });
                }else{
                    //this price code is an exact match of the previous
                    selectedInput.val(o.qty);
                }
            });
            validateFilters();
            updateOrderState();
        }catch(e){
            console.log("Error: Could not parse previous selections:");
            console.log(e);
        }
        
    }
    function storeSelections(){
        localStorage.setItem("bundleUpgrade", "");
        localStorage.setItem("mainQty",$("#qty-txt").val());
        localStorage.setItem("fromDateFilter", $("#fromDateFilter").val());
        localStorage.setItem("toDateFilter", $("#toDateFilter").val());
        localStorage.setItem("fromDate", myState.fromDate);
        localStorage.setItem("toDate", myState.toDate);

        var selections = [];
        $(".qty-small-text.pc-select-text").each(function(){
            if(parseInt($(this).val()) > 0){
                var selectedItem = {};
                selectedItem.performance = $(this).data("performance");
                selectedItem.event = $(this).data("event");
                selectedItem.category = $(this).data("category");
                selectedItem.pricecode = $(this).data("pricecode");
                selectedItem.qty = $(this).val();
                selections.push(selectedItem);
            }
        });
        localStorage.setItem("bundleUpgrade", JSON.stringify(selections));
    }
    function applyUpgradeSelections(){
        $("#qty-txt").val(localStorage.getItem("mainQty"));
        $("#fromDateFilter").val(localStorage.getItem("fromDateFilter"));
        myState.fromDate = new Date(localStorage.getItem("fromDate"));
        $("#toDateFilter").val(localStorage.getItem("toDateFilter"));
        myState.toDate = new Date(localStorage.getItem("toDate"));
        validateFilters();
    }
    
    //-------------------------------------------------------UI control--------------------------------------------------
    function renderBundleData() {
        //double check our filters
        if(orderData.partySize == 0 && myState.viewMode != "event"){
            bundleData.reset();
            return;
        }
        //if this is the initial load, we'll skip this - this should be extended to check that bundle data returned is sufficient to fulfill order requirements
        if(myState.fromDate == -1 || myState.toDate == -1)
            return;
        //DATE VIEW
        if(myState.viewMode == "date"){
            //get a list of existing date items
            var existingDates = [];
            $(".bundle-date").each(function(){
                existingDates.push($(this).data("date")); //existing dates is an array of dates already rendered in a previous request, still present because tickets were selected
            });
            //create containers and headers for each of the dates present
            bundleData.dates.forEach(function (dto) {
                if (existingDates.indexOf(dto) == -1)
                    drawDateItem(dto);//only draw dates that aren't already drawn.
            });
            //add events to each of the dates represented in its perfromances
            bundleData.events.forEach(function (ev) {
                var addedToDates = [];
                ev.performances.forEach(function (perf) { //cycle through each performance and see if it has been added to its date yet
                    if(existingDates.indexOf(perf.startDate) == -1){ //performance item was already written out and selected in a previous request
                        if (addedToDates.indexOf(perf.startDate) == -1 || perf.name != ev.name) {
                            ev.seatingMapImage = perf.seatingMapImage//set the seatmap image
                            if(perf.name == ev.name)
                                addedToDates.push(perf.startDate);
                            //this event has not been added to this date yet
                            //      Example: The ICE! event has 3 ICE! Performances, 1 Fireworks Show, and 2 ICE! Parade performance:
                            //          ICE! event is added with 3 times for each of the performances with the same name
                            //          Each ICE! Parade performance is added as its own entity
                            //          The Fireworks Show is added as its own entity
                            if(ev.name != perf.name){
                                drawEventItem(perf, perf.startDate, true); //adds event item to list
                            }else{
                                drawEventItem(ev, perf.startDate, false); //adds event item to list
                            }
                        }
                    }
                });
            });
        }else{
            //Event View -- DEFAULT
            bundleData.events.forEach(function(ev){
                drawEventContainer(ev);
                ev.performances.forEach(function(perf){
                    drawEventItem(perf, perf.startDate, true)
                })
            });

        }
        $("#BundleItemsWrap").show().slideDown(600);
        if(myState.purchaseMode != "addon")
            $("#BundleInstructions").show();
        handleLoaded();
        updateOrderState();
        
        fetchUpgradeInfo(bundleData.bundleID);
    }
    function drawEventContainer(ev) {
        //creates an event container, and event header for each event in bundle data, these are them populated with performances
        var eventContainerDiv = document.createElement("div");
        eventContainerDiv.setAttribute("class", "bundle-event-container");
        eventContainerDiv.innerHTML = '<span class="event-container-header">' + ev.name + '</span>'
        eventContainerDiv.setAttribute("data-event", ev.id);
        $("#BundleItemsContainer").append(eventContainerDiv);
        var eventDescriptionDiv = document.createElement("div");
        eventDescriptionDiv.innerHTML = ev.description;
        eventDescriptionDiv.setAttribute("class","bundle-event-description clear");
        $(eventContainerDiv).append(eventDescriptionDiv);
        if(ev.img1.toLowerCase() != "blank.gif" && ev.img1 != ""){
            var eventImage = document.createElement("img");
            eventImage.setAttribute("class","bundle-event-image");
            eventImage.setAttribute("src","//qa-pcc.showare.net/uplimage/" + ev.img1); //this is static until I get the API updated
            $(eventDescriptionDiv).prepend(eventImage);
        }
        
        var eventPerformancesDisplayButton = document.createElement("button");
        eventPerformancesDisplayButton.setAttribute("class", "button event-performances-display-button");
        eventPerformancesDisplayButton.innerHTML = '<i class="fa fa-chevron-circle-up" aria-hidden="true"></i>Show Dates and Times';
        $(eventContainerDiv).append(eventPerformancesDisplayButton);
        
    }
    function drawDateItem(d) {
        //creates a date container, and date header for each date in bundle data, these are them populated with performances
        var dateoptions = { weekday: 'long', month: 'short', day: 'numeric' };
        var dateItemDiv = document.createElement("div");
        var dateSplit = String(d).split("-");
        dateItemDiv.setAttribute("class", "bundle-date");
        if(dateSplit.length == 2){
            dateItemDiv.innerHTML = '<span class="date-header">' + new Date(dateSplit[0]).toLocaleDateString('en-US', dateoptions) + ' - ' + new Date(dateSplit[1]).toLocaleDateString('en-US', dateoptions) +'</span>'
        }else{
            dateItemDiv.innerHTML = '<span class="date-header">' + new Date(d).toLocaleDateString('en-US', dateoptions) + '</span>'
        }
        dateItemDiv.setAttribute("data-date", d);
        $("#BundleItemsContainer").append(dateItemDiv)
    }
    function drawEventItem(eventObj, d, isPerformance) {
        //adds event items to containers as a new container.
        var eventViewDateOptions = { weekday: 'short', month: 'short', day: 'numeric' };

        var myParentContainer;
        if(myState.viewMode == "date"){
            myParentContainer = $("[data-date='" + d + "']");
        }else{
            myParentContainer = $(".bundle-event-container[data-event='" + eventObj.eventID + "']");
        }
        var myVenue, myStartTime;
        if(!isPerformance){
            myVenue = eventObj.performances[0].venue.name;
            myStartTime = eventObj.performances[0].startTime;
        }else{
            myVenue = eventObj.venue.name;
            myStartTime = eventObj.startTime;
        }
        var eventItemDiv = document.createElement("div");var eventContentsDiv = document.createElement("div");var eventDescriptionDiv = document.createElement("div");var eventTimesDiv = document.createElement("div");var eventPricesDiv = document.createElement("div");var seatmapImageDiv = document.createElement("div");
        eventItemDiv.setAttribute("class", "bundle-event-item clear sold-out bundle-event-item-" + eventObj.eventID);//note that all events start as sold out and have that status removed when a category is added with tickets in it
        var performanceDateString;
        var perfLength = Math.abs(new Date(eventObj.performanceEnd).getTime() - new Date(eventObj.performanceStart).getTime()) / (1000 * 3600 * 24); //get # of days in the performance
        if(perfLength < 1){
            //single day performance
            try{
                performanceDateString = new Date(d).toLocaleDateString('en-us',eventViewDateOptions);
                performanceDateString += " " + myStartTime;
            }catch(e){
                console.log(e);
            }
        }else{
            //multi day performance
            try{
                performanceDateString = new Date(eventObj.performanceStart).toLocaleDateString("en-US", eventViewDateOptions) + " - " + new Date(eventObj.performanceEnd).toLocaleDateString("en-US", eventViewDateOptions);
            }catch(e){
                console.log(e);
            }
        }
        if(myState.viewMode == "date"){
            //date view does not require every performance have a date specified, they're already listed by date
            eventItemDiv.innerHTML = '<span class="event-header"><i class="fa fa-chevron-circle-up" aria-hidden="true"></i>' + eventObj.name + '</span>';
        }else{
            eventItemDiv.innerHTML = '<span class="event-header"><i class="fa fa-chevron-circle-up" aria-hidden="true"></i>' + eventObj.name + '<span class="event-header-date">' + performanceDateString + '</span></span>';
        }
        
        eventItemDiv.setAttribute("data-eventID", eventObj.eventID);
        if(eventObj.seatingMapImage)
            eventItemDiv.setAttribute("data-seatmap-image", eventObj.seatingMapImage.toLowerCase());
        if(isPerformance)
            eventItemDiv.setAttribute("data-performanceID", eventObj.id);
        eventItemDiv.setAttribute("data-event-date", eventObj.startDate);
        if(isPerformance)
            eventItemDiv.setAttribute("data-event-end-date", new Date(eventObj.performanceEnd).getMonth() + 1 + '/' + new Date(eventObj.performanceEnd).getDate() + '/' +  new Date(eventObj.performanceEnd).getFullYear());
        myParentContainer.append(eventItemDiv);
        eventContentsDiv.setAttribute("class", "bundle-event-item-contents clear");
        $(eventItemDiv).append(eventContentsDiv);
        //if this is a multi-day performance, add the date range
        try{
            if(myState.viewMode == "date" && perfLength > 1){
                eventContentsDiv.innerHTML = '<span class="event-date-range">' + performanceDateString + "</span>";
            }
        }catch(e){
            console.log(e);
        }
        eventDescriptionDiv.setAttribute("class", "bundle-event-item-description");
        //we'll add this below, based on how many times we have
        $(eventContentsDiv).append(eventDescriptionDiv);
        eventTimesDiv.setAttribute("class", "bundle-event-item-times clear");
        $(eventContentsDiv).append(eventTimesDiv);
        seatmapImageDiv.setAttribute("class", "bundle-event-item-seatmap-image clear");
        $(eventContentsDiv).append(seatmapImageDiv);
        eventPricesDiv.setAttribute("class", "bundle-event-item-prices clear");
        $(eventContentsDiv).append(eventPricesDiv);
        if(!isPerformance){
            //check for multiple times, and draw pricing for each time slot available
            var eventTimes = eventObj.performances.filter(function (perf) { return perf.startDate == d && perf.name == eventObj.name });
            if(eventTimes.length > 1){
                //multiple times for this event based on child performances
                var isActive = true;//is active determines if the timeslot's pricing is displayed - when a time is selected we display the pricing for that time
                eventTimes.forEach(function(perfTime){
                    var availableClass = " disabled sold-out";
                    perfTime.seatCategories.forEach(function(a){
                        if(a.numSeatsAvailable > 0)
                            availableClass = "";//snce this time has a category with tickets available, it is not sold out
                    });
                    //draw each of the time slots and its corresponding pricing
                    var timeButton = document.createElement("button");
                    if(isActive){
                        timeButton.setAttribute("class", "button button-time active" + availableClass);
                    }else{
                        timeButton.setAttribute("class", "button button-time" + availableClass);
                    }
                    timeButton.setAttribute("data-performanceID", perfTime.id);
                    timeButton.innerHTML = perfTime.startTime;
                    $(eventTimesDiv).append(timeButton);
                    drawPricing(perfTime.seatCategories, perfTime.eventID, perfTime.id, eventPricesDiv, eventItemDiv, isActive);
                    if(isActive)
                        eventDescriptionDiv.innerHTML = renderEventDescription(eventObj.description, perfTime.id, myVenue, "");
                    isActive = false;//the first pricing set has been set to active, and the first button, set all others to false
                });
            }
            //single time, or variable name
            if(eventTimes.length === 1){
                drawPricing(eventTimes[0].seatCategories, eventTimes[0].eventID, eventTimes[0].id, eventPricesDiv, eventItemDiv, true);
                eventDescriptionDiv.innerHTML = renderEventDescription(eventObj.description, eventTimes[0].id, myVenue + " @ ", myStartTime);
            }
        }else{
            //single performance passed in
            //performances, just need to draw pricing
            drawPricing(eventObj.seatCategories, eventObj.eventID, eventObj.id, eventPricesDiv, eventItemDiv, true);
            eventDescriptionDiv.innerHTML = renderEventDescription(eventObj.description, eventObj.id, myVenue + " @ ", myStartTime);
        }
    }
    function drawPricing(priceCategories, eventID, performanceID, eventPricesDiv, eventItemDiv, isActive){
        //adds a container and set of price codes, with inputs, for each performance
        //in events with multiple times, only the selected time's pricing is visible
        priceCategories.forEach(function(pc){
            var activeClass = "";
            if(isActive)
                activeClass = "active"; //active class determines if this set is displayed, used for multiple time slots

            var priceCategoryDiv = document.createElement("div");
            var categoryClass = "price-category-performance-" + performanceID;
            if(pc.numSeatsAvailable < 1){
                categoryClass += " sold-out disabled";
            }else{
                //this category has tickets, so set the event to on sale
                $(eventItemDiv).removeClass("sold-out");
            }
            priceCategoryDiv.setAttribute("class", "price-category-wrap " + categoryClass + " " + activeClass);
            priceCategoryDiv.innerHTML = '<span class="price-category-header">' + pc.name + '</span>';
            $(eventPricesDiv).append(priceCategoryDiv);
            pc.pricingCodes.forEach(function(priceCode){
                var priceCodeInputDiv = document.createElement("div");
                if(priceCode.printedPrice === priceCode.price || priceCode.printedPrice == 0 || priceCode.printedPrice == "" || priceCode.printedPrice < priceCode.price){
                    var pcPriceString = ['<span class="new-price">$',parseFloat(priceCode.price).toFixed(2),'</span>'].join("");
                }else{
                    var pcPriceString = ['<span style="white-space:nowrap;"><span class="old-price">$',parseFloat(priceCode.printedPrice).toFixed(2),'</span><span class="new-price">$',parseFloat(priceCode.price).toFixed(2),'</span></span>'].join("");
                }
                var pcString = String(performanceID + pc.categoryId + priceCode.name).split(' ').join('');
                var pcLabel = priceCode.name + pcPriceString;
                priceCodeInputDiv.setAttribute("class","bundle-price-code-wrap input-with-incremental-buttons clear");
                //this is ugly, but actually works out to less code
                if(bundleData.UniformPurchase && (myState.purchaseMode != "addon" || uniformAddons === true)){
                    $(priceCodeInputDiv).css("display", "none");
                    priceCodeInputDiv.innerHTML = '<input id="' + pcString + '" name="' + pcString + '" class="qty-small-text showare-text pc-select-text" type="number" data-performance="' + performanceID + '" data-event="' + eventID + '" data-category="' + pc.categoryId + '" data-pricecode="' + priceCode.pricingCode + '" data-pcname="' + priceCode.name + '" data-available="' + pc.numSeatsAvailable + '" style="display:none;" disabled="disabled">'
                }else{
                    priceCodeInputDiv.innerHTML = '<label for="' + pcString + '" class="price-code-name-label">' + pcLabel + '</label><a class="button pc-increment-button qty-reduce disabled">-</a><input id="' + pcString + '" name="' + pcString + '" class="qty-small-text showare-text pc-select-text" type="number" data-performance="' + performanceID + '" data-event="' + eventID + '" data-category="' + pc.categoryId + '" data-pricecode="' + priceCode.pricingCode + '" data-pcname="' + priceCode.name + '" data-available="' + pc.numSeatsAvailable + '"><a class="button pc-increment-button qty-add">+</a>'
                }
                $(priceCategoryDiv).append(priceCodeInputDiv);
            });
            if(bundleData.UniformPurchase && pc.numSeatsAvailable >= unifiedQty.totalQty && (myState.purchaseMode != "addon" || uniformAddons === true)){
                $(priceCategoryDiv).append('<button onclick="selectUnifiedCategory(this, ' + performanceID + ',' + pc.categoryId + ')" class="pc-select-button button"><i class="fa fa-square-o button-icon"></i><i class="fa fa-check-square button-icon"></i>Select</button>');
                $(priceCategoryDiv).css("padding-bottom", "10px")
            }
        });
        
    }
    function renderAddOns(){
        myState.purchaseMode = "addon";
        showTray(false);
        $("#BundleInstructions").hide();
        $('html, body').animate({
            scrollTop: 0
        }, 400);

        $("#BundleMainWrap").slideUp(600, function(){
            $("#BundleDescription").html(bundleData.addOnDescription);
            $("#BundleName").hide();
            $("#BundleFiltersWrap").hide();
            $("#BundleItemsWrap .section-label").hide();
            $("#BundleInstructions").hide();
            $("#BundleItemsContainer").html("");
            bundleData.events = bundleData.addOns;
            bundleData.extractData();
            renderBundleData();
            $("#BundleMainWrap").append('<div id="AddOnContinueWrap" class="clear"><button id="AddOnContinueButton" class="button sw-button-primary">Proceed to Checkout</button>');
        }).slideDown(400);
    }
    function showTray(show){
        var trayHeight = $("#BundleTray").height();
        trayHeight += 100;
        if(show){
            $("#BundleTray").removeClass("hide").css("bottom","-1em");
        }else{
            $("#BundleTray").addClass("hide").css("bottom","-" + trayHeight + "px");
        }
    }
    function renderEventDescription(description, performanceID, venue, startTime){
        var descriptionInfoLink = ' <a style="text-decoration:underline;" class="pl-popup-link" href="Javascript:popUp(\'More Info\',\'PerformanceDetailPopUp.asp?evt=' + performanceID + '\', 400, 480,\'no\',\'yes\',\'no\',\'no\')">more info</a>';
        var venueTimeInfo = '<div class="bundle-venue-info">' + venue + ' <time class="bundle-start-time">' + startTime + '</time></div';
        if(description.length > 600){
            var trimD = trimHtml(description);
            return trimD.html + descriptionInfoLink + venueTimeInfo;
        }else{
            return description + venueTimeInfo
        }
    }
    function loadSeatmapImage(performanceContainer){
        var myImage = $(performanceContainer).data("seatmap-image");
        if(myImage == "blank.gif" || myImage == "")
            return;
        var imageContainer = $(performanceContainer).find(".bundle-event-item-seatmap-image");
        var seatmapImage = document.createElement("img");
        seatmapImage.setAttribute("class","bundle-seatmap-image");
        seatmapImage.setAttribute("src","//qa-pcc.showare.net/UPLImage/" + myImage);
        $(imageContainer).append(seatmapImage);
        $(performanceContainer).data("seatmap-image", "");
    }
    function categorySumExceeded(categoryID, available) {
        var selectedSum = 0;
        $(".pc-select-text").filter(":visible").each(function () {
            if ($(this).data("category") == categoryID && $(this).val() != "") {
                selectedSum += parseInt($(this).val());
            }
        })
        return selectedSum > available;
    }
    $(function(){
        //incrimental buttons for price codes
        $(document.body).on('click', '.pc-increment-button', function(){
            var myInput = $(this).siblings(".pc-select-text");
            var myVal = parseInt(myInput.val()) || 0;            

            if($(this).hasClass("qty-reduce")){
                myVal--;
            }else{
                myVal++;
            }
            if(myVal < 1 || myVal > 99){
                myVal = 0;
                myInput.val("");
                $(this).siblings(".qty-reduce").addClass("disabled");
                if($(this).hasClass("qty-reduce")){
                    $(this).addClass("disabled");
                }
            }else{
                myInput.val(myVal);
                $(this).siblings(".qty-reduce").removeClass("disabled");
            }
           
            if (categorySumExceeded($(myInput).data("category"), $(myInput).data("available"))) {
                if($(this).parent().parent().find(".price-category-available-warning").length == 0)
                    $(this).parent().parent().append('<span class="price-category-available-warning">Warning: Exceeds Availability (' + $(myInput).data("available") + ')')
            } else {
                 $(this).parent().parent().find(".price-category-available-warning").remove();
            }
            updateOrderState();
        }).on('change blur', '.pc-select-text', function () {
           
            var myVal = parseInt($(this).val()) || 0;
            
            if (categorySumExceeded($(this).data("category"), $(this).data("available"))) {
                if($(this).parent().parent().find(".price-category-available-warning").length == 0)
                    $(this).parent().parent().append('<span class="price-category-available-warning">Warning: Exceeds Availability (' + $(this).data("available") + ')')
            } else {
                $(this).parent().parent().find(".price-category-available-warning").remove();
            }
            if(myVal < 1 || myVal > 99){
                $(this).val("");
                $(this).siblings(".qty-reduce").addClass("disabled");
            }else{
                $(this).siblings(".qty-reduce").removeClass("disabled");
            }
            updateOrderState();
        }).on('click', '.event-header', function(e){
            //individual performance show/hide
            if($(this).parent().hasClass("active")){
                closeEventPerformance($(this).parent())
                return;
            }
            loadSeatmapImage($(this).parent())
            
            $(this).parent().addClass("active").children(".bundle-event-item-contents").slideDown(400, function(){
                if(!isScrolledIntoView($(this))){
                    $('html, body').animate({
                        scrollTop: $(this).offset().top - 150
                    }, 200);
                }
            });
        }).on('click', '.event-performances-display-button', function(){
            //event container show/hide only relevant in event-based bundles
            if($(this).hasClass("on")){
                $(this).removeClass("on");
                $(".bundle-event-item.active").removeClass("active").find(".bundle-event-item-contents").slideUp(400);
                $(this).parent().children(".bundle-event-item").not(".selected").slideUp(400);
            }else{
                $(this).addClass("on");
                $(this).parent().children(".bundle-event-item").slideDown(400);
            }
        }).on('click', '.button-time', function(){
            if($(this).hasClass("active"))
                return;
            var prevActive = $(this).siblings(".button-time.active").data("performanceid");
            if(!prevActive){
                return; //apparently there are no other times.... so that's awkward - this would be an error of sorts. This should never happen
                console.log("Single Performance with time option - not valid");
            }
            $(".price-category-performance-" + prevActive).removeClass("active").find(".pc-select-text").val("");
            $(this).siblings(".button-time").removeClass("active");
            $(this).addClass("active");
            $(".price-category-performance-" + $(this).data("performanceid")).addClass("active");
            var myPopUp = $(this).parent().parent().find(".pl-popup-link");
            myPopUp.attr("href", "Javascript:popUp('More Info','PerformanceDetailPopUp.asp?evt=" + $(this).data("performanceid") + "', 400, 480,'no','yes','no','no')")
            updateOrderState();
        }).on('click','#BundleContinueButton', function(){
            if (!bundleData.validateOrderRequirements()) { //just to be safe, validate the order one more time
                return;
            }
            orderData.getBundlePurchase(); //populates the order data for the bundle
            if (bundleData.addOns.length > 0) {
                //add ons exist, we should render those
                renderAddOns();
                $("#BundleInstructions").hide();
            } else {
                //no add ons, submit the order and wait for response
                placeBundleOrder();
            }
        }).on('click','#AddOnContinueButton', function(){
            orderData.getAddOnPurchase(); //populates the order data for the bundle
            placeBundleOrder();
        });
    });
    function renderSelectButton(container){
        var selectButton = document.createElement("button");
        selectButton.setAttribute("class", "pc-select-button button");
        selectButton.innerHTML = '<i class="fa fa-square-o button-icon"></i><i class="fa fa-check-square button-icon"></i>Select';
        $(selectButton).on("click", function(){
            $(this).toggleClass("selected");
            //THIS NEEDS TO BE A FOR LOOP GOING THROUGH SELECTIONS AND ADDING [{selectedPriceCode: CODE1, selectedQty: 1}, {selectedPriceCode: CODE2, selectedQty: 2}] for example
            var myInput = $(this).siblings(".pc-select-text");
            if($(this).hasClass("selected")){
                myInput.val(4).change();
            }else{
                myInput.val(0).change();
            }
        })
        container.append(selectButton);
    }
    function addS(qty){
        if(qty > 1 || qty == 0){
            return "s";
        }else{
            return "";
        }
    }
    function getFormattedDate(date) {
        var theDate;
        try{
            theDate = String(date).split("-");
        }catch(e){
            console.log(e);
            return;
        }
        var year = theDate[0];

        var month = theDate[1];
        
        month = month.length > 1 ? month : '0' + month;

        var day = (String(theDate[2]).split("T"))[0];
        day = day.length > 1 ? day : '0' + day;
  
        return month + '/' + day + '/' + year;
    }
    function trimHtml(html, options) {

        options = options || {};

        var limit = options.limit || 600,
            preserveTags = (typeof options.preserveTags !== 'undefined') ? options.preserveTags : true,
            wordBreak = (typeof options.wordBreak !== 'undefined') ? options.wordBreak : false,
            suffix = options.suffix || '...',
            moreLink = options.moreLink || '';

        var arr = html.replace(/</g, "\n<")
            .replace(/>/g, ">\n")
            .replace(/\n\n/g, "\n")
            .replace(/^\n/g, "")
            .replace(/\n$/g, "")
            .split("\n");

        var sum = 0,
            row, cut, add,
            tagMatch,
            tagName,
            tagStack = [],
            more = false;

        for (var i = 0; i < arr.length; i++) {

            row = arr[i];
            // count multiple spaces as one character
            rowCut = row.replace(/[ ]+/g, ' ');

            if (!row.length) {
                continue;
            }

            if (row[0] !== "<") {

                if (sum >= limit) {
                    row = "";
                } else if ((sum + rowCut.length) >= limit) {

                    cut = limit - sum;

                    if (row[cut - 1] === ' ') {
                        while(cut){
                            cut -= 1;
                            if(row[cut - 1] !== ' '){
                                break;
                            }
                        }
                    } else {

                        add = row.substring(cut).split('').indexOf(' ');

                        // break on halh of word
                        if(!wordBreak) {
                            if (add !== -1) {
                                cut += add;
                            } else {
                                cut = row.length;
                            }
                        }
                    }

                    row = row.substring(0, cut) + suffix;

                    if (moreLink) {
                        row += '<a href="' + moreLink + '" style="display:inline"></a>';
                    }

                    sum = limit;
                    more = true;
                } else {
                    sum += rowCut.length;
                }
            } else if (!preserveTags) {
                row = '';
            } else if (sum >= limit) {

                tagMatch = row.match(/[a-zA-Z]+/);
                tagName = tagMatch ? tagMatch[0] : '';

                if (tagName) {
                    if (row.substring(0, 2) !== '</') {

                        tagStack.push(tagName);
                        row = '';
                    } else {

                        while (tagStack[tagStack.length - 1] !== tagName && tagStack.length) {
                            tagStack.pop();
                        }

                        if (tagStack.length) {
                            row = '';
                        }

                        tagStack.pop();
                    }
                } else {
                    row = '';
                }
            }

            arr[i] = row;
        }

        return {
            html: arr.join("\n").replace(/\n/g, ""),
            more: more
        };
    }

    if (typeof module !== 'undefined' && module.exports) {
        module.exports = trimHtml;
    }
    function isScrolledIntoView(elem) {
        var docViewTop = $(window).scrollTop();
        var docViewBottom = docViewTop + $(window).height();

        var elemTop = $(elem).offset().top;
        var elemBottom = elemTop + $(elem).height();

        return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
    }

    showTray(false);

    //fixing IE
    Number.isInteger = Number.isInteger || function(value) {
        return typeof value === "number" &&
               isFinite(value) &&
               Math.floor(value) === value;
    };
    //make contains case insensative
    $.expr[":"].contains = $.expr.createPseudo(function(arg) {
        return function( elem ) {
            return $(elem).text().toUpperCase().indexOf(arg.toUpperCase()) >= 0;
        };
    });
</script>

			</div><!--End main-container #END-->
			<!-- end main arean -->
			<div class="clear-float"></div><!--force inner-content pas floated left and right sections-->
			
		</div><!--END content-inner END-->
	</div><!--END content-wrap END-->

	<div class="foot-wrap">
		<div class="foot-inner center-div site-width">
           
			<center><img class='ad-image' src=/AdsUPLImage/blank.gif width=1 height=1 border=0 alt=></center>

			<span class="copyright-text">
			Copyright &copy; 2020&nbsp;Polynesian Cultural Center, All Rights Reserved. <span class="no-mobile">-</span> <br class="mobile-only" />
			<em style="margin-right:6px;"><a href="http://www.showare.com" target="_blank">accesso ShoWare&#8480;</a></em> ticketing System provided by <em><a href="http://www.accesso.com" target="_blank">accesso<span style="font-size:10px;">&#174;</span></a></em><br><br>
			<span class="copyright-text">Please read our <a href="Javascript:popUp('Privacy Statement','privacystatement.asp',350,420,'no','yes','no','no')">Privacy Statement</a> and <a href="Javascript:popUp('Terms of Use','termsofuse.asp',350,420,'no','yes','no','no')">Terms of Use</a>.</span>
			<br><br>
			</span><!--END copyright-text span END-->

			
			<script language="JavaScript" type="text/javascript">
                //variable defined via external script from HTMLHeadClose.asp
                if (typeof TrustLogo !== "undefined") {
                    TrustLogo("https://qa-pcc.showare.net/images/comodo.png", "CL1", "none");
                }
            </script>
		

		</div><!--END foot-inner END-->
	</div><!--END foot-wrap END-->



</div><!--END page-wrap END-->
<script>
$("#fromDateFilter").attr("placeholder", "mm/dd/yyyy");

 setTimeout(function() {
 $(document).ready(function(){
	$(".featured-items-image").each(function () {
		if($(this).attr('src')){
			var imgSrc = $(this).attr('src').split("/");
				imgSrcImgName = imgSrc[imgSrc.length-1];
			if (imgSrcImgName == "blank.gif"){
				$(this).addClass("display-none");
			}
		}
	 });
	 $("#UniformGoButton").html("Or, Add Bus Transportation");
	 $("#UniformPriceCodesContainer").append('<button id="UniformGoButton-skip" onclick="SetUnifiedQty(true);clearAddOn = true;" class="button">Proceed To Checkout</button>')
	 
 }); 
 }, 500);
</script>
<script>
	var clearAddOn = false;
	$(".bundle-basket-item .bundle-basket-tickets").each(function(){
		var numtix = $(this).children(".bundle-basket-ticket-item").length;
		$(this).prepend('<span style="font-size:1.5em;opacity:0.6;font-weight:bold;">Quantity: ' + numtix + '</span>');
	});
	
	try{
		var buildTicketList_orig = buildTicketList;
		buildTicketList = function(){
			buildTicketList_orig();
			
			var ticketTotal = 0;
			var feeTotal = 0;
			basket.items.tickets.forEach(function(t){
				ticketTotal += t.Price;
				feeTotal += t.TransactionFee + t.Tax + t.ExtFee2 + t.ExtFee3;
			});
			$("#BundleContainer .checkout-basket-item-total").html("$" + String(ticketTotal.toFixed(2)));
			$("#summaryDeliveryFeesTotal").html("$" + String(feeTotal.toFixed(2))).attr("id", "");
			$(".checkout-basket-total .minor-label").html("Taxes and Fees");
		}
	}catch(e){
		//nada
	}
	function handleLoaded(){
			if(clearAddOn){bundleData.addOns = [];}
            //$("#BundleItemsWrap").show();
            $("#BundleFiltersWrap").removeClass("disabled");
            $("#LoadWrap").hide();
            $("#AddOnContinueButton").show();
            
			doDualPricing();
			$(".bundle-event-container").hide();
			if(myState.purchaseMode == 'addon'){
				
				var transSelect = $("#TransportationSelect").detach();
				$(".event-performances-display-button").remove();
				$(".bundle-event-item").show().addClass('active');
				$(".bundle-event-item-contents").show();
				$("#BundleItemsWrap").prepend(transSelect);
				$(".bundle-event-container").each(function(i, bundleEvent){
					var eventName = $(this).find(".event-container-header").html();
					var eventID = $(this).data("event");
					var optionHTML = '<option value="' + eventID + '">' + eventName + '</option>';
					$("#TransportationOptions").append(optionHTML);
				})
				$('#TransportationOptions').select2();
			}
			$(".pc-select-text").each(function(){
				var myPCSelect = $(this);
				var myWrapper = $(this).parent();
				$(".pc-increment-button").hide();
				$(this).hide();
				var selectButton = document.createElement("button");
				selectButton.setAttribute("class", "pc-select-button button");
				$(selectButton).css("width", "100%");
				selectButton.innerHTML = '<i class="fa fa-square-o button-icon"></i><i class="fa fa-check-square button-icon"></i>Select';
				$(selectButton).on("click", function(){
					$(this).toggleClass("selected");
					var myInput = $(this).siblings(".pc-select-text");
					if($(this).hasClass("selected")){
						myInput.val(unifiedQty.totalQty).change();
					}else{
						myInput.val(0).change();
					}
				});
				myWrapper.append(selectButton).css("height", "45px");
			})
			
        }
		function selectHotel(eventID){
			$(".bundle-event-container").hide();
			$(".bundle-event-container").each(function(i, bundleEvent){
				if($(this).data("event") == eventID){
					$(this).show();
				}
			});
		}
		function doDualPricing(){
			myState.viewMode = "event"
			var childVal = parseInt($("#qty-child-txt").val());
			var adultVal =  parseInt($("#qty-adult-txt").val());
			$(".sold-out").remove();
			$(".pc-select-text").each(function(){
				$(this).val(unifiedQty[$(this).data("pricecode")])
			})
			bundleData.ticketsAutoAdded = true;
			
		}
		if($("#BundleFiltersWrap")){
			var filterwrap = $("#BundleFiltersWrap").detach();
			$("#BundleDescription").prepend(filterwrap);
		}
		$(".bundle-basket-ticket-item .is-reserved").parent().show();
		$(".is-reserved").parent().parent().append('<span style="float:right;font-weight:bold;">We have selected the best seats for you. If you would like to select your own, please click the button.</span><div class="clear"></div>')
		try{
			$("h2#BundleName").html($("h2#BundleName").html().split("-")[0])
		}catch(e){

		}
		function updateSpecialSeating(ssVal){
			var requestData = {}
			requestData.SpecialNeedsSelection = ssVal
			$.get("/include/SessionUpdate.asp", requestData).done(function(response){
				//nothing to do here yet.
			})
		}
		
</script>
<div style="display:none;">
	<div id="TransportationSelect">
		<div class="trans-select-left">
			<div style="color: #993300; font-size: 18pt;line-height:34px;">Please select your hotel:</div><select id="TransportationOptions" class="showare-select" style="margin-bottom:10px;" onchange="selectHotel(this.value);"><option>Please Select</option></select>
			
		</div>
		<div class="trans-select-right">
			<span style="color: #993300; font-size: 18pt;line-height:34px;">Do you have any special needs?</span>
			<select id="SpecialNeedsOptions" class="showare-select" style="margin-bottom:10px;" onchange="updateSpecialSeating(this.value)">
				<option value="None">Please Select</option>
				<option value="Wheelchair">Wheelchair</option>
				<option value="Electro Wheelchair">Electro Wheelchair</option>
				<option value="Front Row Seats on the Bus">Front Row Seats on the Bus</option>
				<option value="Child 4-11">Child 4-11</option>
				<option value="Moto 4 Wheels">Moto 4 Wheels</option>
				<option value="Moto 3 Wheels">Moto 3 Wheels</option>
				<option value="Stroller">Stroller</option>
				<option value="Return Trip Only">Return Trip Only</option>
			</select>
		</div>
	</div>
</div>
<script language="javascript">
    $(function () {
        //activate modals
        hoverModal();
    });
</script>




    <script async src="//qa-pcc.showare.net/include/widgets/basket/basketwidget.js" id="showarebasketscript" type="text/javascript"></script>


<script>
    var cb = function() {
    var l = document.createElement('link'); l.rel = 'stylesheet';
    l.href = '/include/jqueryui-themes/default/jquery-ui.css';
    var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
    };
    var raf = window.requestAnimationFrame       || 
          window.webkitRequestAnimationFrame || 
          window.mozRequestAnimationFrame    || 
          window.oRequestAnimationFrame      || 
          window.msRequestAnimationFrame     ;
    if (raf) raf(cb);
    else window.addEventListener('load', cb);
</script>

<script type="text/javascript">
    $("body").addClass("bundleselect");
    if(window.location.hostname.toLowerCase() != "qa-pcc.showare.net"){
        Showare.Logger.warn("Bad Domain Request","qa-pcc.showare.net - " + window.location.hostname);
        window.location.replace("//qa-pcc.showare.net");
    }

</script>

<!-- ARIA ACCESSABILITY FEATURES -->
<script type="text/javascript">
    try{
        $(".main-container").attr("role","main");
        $("ul.showare-nav").attr("role","menubar");
        $("ul.showare-nav li").attr("role","menuitem");
        $(".search-control").attr("role","search");
        $("input.search-text").attr("aria-label","Search");
        $(".control-wrap").attr("role","complementary");
        $("header.head-wrap").attr("role","banner");
        $("div.foot-wrap").attr("role","contentinfo");
        $("a.header-logo-link h1").attr("aria-hidden","true");
        //add a basket link for aria to read
        $("li.basket-widget").prepend('<a tabindex="0" class="aria-basket-link" href="basket.asp">Shopping Cart</a>');
    }catch(e){
        console.log("Failed to update header for accessability:");
        console.log(e);
    }
</script>
</body>
</html>
